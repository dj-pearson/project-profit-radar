version: '3.8'

services:
  edge-functions:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: supabase-edge-functions
    ports:
      - "8000:8000"
    environment:
      # Load from .env file
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - PORT=8000
    volumes:
      # Mount functions directory for hot reload during development
      - ./functions:/app/functions:ro
      # Mount server.ts for development
      - ./server.ts:/app/server.ts:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/_health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - supabase

networks:
  supabase:
    driver: bridge

# Usage:
# 1. Copy .env.example to .env and configure
# 2. Start: docker-compose up
# 3. Stop: docker-compose down
# 4. Rebuild: docker-compose up --build
# 5. View logs: docker-compose logs -f edge-functions

