# Run all the migration repair commands suggested by Supabase
# This will synchronize the migration history table with your local files

Write-Host "Repairing migration history..." -ForegroundColor Cyan

# Mark remote-only migrations as reverted (not in local files)
$revertedMigrations = @(
    "20250702103638", "20250702105409", "20250703011355", "20250703013017",
    "20250703014005", "20250703015658", "20250703015817", "20250703020357",
    "20250703025254", "20250703025515", "20250703025633", "20250703031622",
    "20250703032909", "20250703033803", "20250703035746", "20250703041435",
    "20250703043419", "20250703044307", "20250703044714", "20250703045406",
    "20250703045447", "20250703050527", "20250703052933", "20250703053407",
    "20250703055853", "20250703073047", "20250703080625", "20250703102246",
    "20250704021321", "20250704021454", "20250704045433", "20250704063842",
    "20250705075454", "20250706010331", "20250706011414", "20250706011715",
    "20250706012033", "20250706014204", "20250706015013", "20250706025848",
    "20250706042032", "20250706042847", "20250706043405", "20250706125326",
    "20250707014027", "20250707014751", "20250707015746", "20250707020438",
    "20250707022611", "20250707023823", "20250708050207", "20250708091201",
    "20250709010119", "20250709011051", "20250709124557", "20250710055948",
    "20250711023359", "20250711072209", "20250712015013", "20250712015111",
    "20250712015611", "20250712020823", "20250712023638", "20250712025036",
    "20250712030308", "20250712052854", "20250712085959", "20250713010230",
    "20250713032625", "20250713122724", "20250714024810", "20250714031022",
    "20250714032152", "20250714034417", "20250714034830", "20250714035107",
    "20250714040700", "20250714114539", "20250714114616", "20250714114649",
    "20250717065300", "20250717074417", "20250717080102", "20250717081023",
    "20250717102907", "20250718010318", "20250718030742", "20250719101824",
    "20250719103321", "20250719103906", "20250719104505", "20250719105024",
    "20250720035819", "20250720095329", "20250722031919", "20250723020106",
    "20250725040050", "20250726012421", "20250727050845", "20250731024934",
    "20250801012115", "20250801013812", "20250801021017", "20250801021557",
    "20250802043052", "20250803010533", "20250803012453", "20250803014111",
    "20250803022619", "20250803024127", "20250803025407", "20250803025834",
    "20250803032922", "20250803033505", "20250803034938", "20250803040315",
    "20250803040917", "20250803095439", "20250803112619", "20250803113016",
    "20250803124954", "20250804010540", "20250805010756", "20250812024257",
    "20250815033839", "20250823012938", "20250823013054", "20250823042307",
    "20250824022630", "20250824023244", "20250824025054", "20250824025601",
    "20250824025946", "20250824030257", "20250824030434", "20250824030740",
    "20250824031003", "20250824031647", "20250824031739", "20250825030510",
    "20250825030952", "20250825031042", "20250825031242", "20250830023201",
    "20250831050659", "20250903060059", "20250904022800", "20250904022844",
    "20250904022931", "20250904025707", "20250904032157", "20250909075109",
    "20250909084821", "20250909084854", "20250911053659", "20250911053745",
    "20250911053824", "20250912060502", "20250912062403", "20250912063604",
    "20250912072351", "20250915053052", "20250916053436", "20250916061844",
    "20250916103420", "20250917095454", "20250923020803", "20250923034630",
    "20250924012207", "20250925013427", "20250925014308", "20250925020622",
    "20250925020703", "20250925091618", "20250930113844", "20251005031153",
    "20251005033259", "20251005033418", "20251005034305", "20251006084551",
    "20251006093003", "20251104012603", "20251104012858", "20251106193105",
    "20251106194325", "20251106194636", "20251109152330", "20251112032711",
    "20251128063252", "20251128071131", "20251129152243", "20251202203729",
    "20251202204507"
)

Write-Host "Marking $($revertedMigrations.Count) remote-only migrations as reverted..." -ForegroundColor Yellow
foreach ($migration in $revertedMigrations) {
    Write-Host "  - $migration" -ForegroundColor Gray
    & supabase migration repair --status reverted $migration
    if ($LASTEXITCODE -ne 0) {
        Write-Host "    Failed!" -ForegroundColor Red
    }
}

Write-Host "`nDone! Now try: supabase db pull" -ForegroundColor Green
