"File","Line","Pattern","Content"
"src\components\onboarding\OnboardingFlow.tsx","260","site_id","// Include site_id for multi-tenant isolation (required by RLS)"
"src\components\onboarding\OnboardingFlow.tsx","278","site_id","// Update user profile with company, site_id, and onboarding preferences"
"src\components\onboarding\OnboardingFlow.tsx","283","site_id","// Ensure site_id is set on user profile for future RLS checks"
"src\components\reports\CustomReportBuilder.tsx","222","site_id","throw new Error('No site_id available');"
"src\components\reports\CustomReportBuilder.tsx","228","site_id","query = supabase.from('projects').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","231","site_id","query = supabase.from('job_costs').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","234","site_id","query = supabase.from('time_entries').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","237","site_id","query = supabase.from('expenses').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","240","site_id","query = supabase.from('invoices').select('*').eq('site_id', siteId);"
"src\components\ProjectWizard.tsx","305","site_id","site_id: userProfile.site_id || null,"
"src\contexts\AuthContext.tsx","820","site_id","// Removed: site_id resolution - single-tenant architecture"
"src\contexts\AuthContext.tsx","911","site_id","// Removed: site_id resolution - single-tenant architecture"
"src\contexts\AuthContext.tsx","953","site_id","// Removed: site_id resolution - single-tenant architecture"
"src\contexts\AuthContext.tsx","1023","site_id","// Removed: site_id resolution - single-tenant architecture"
"src\contexts\AuthContext.tsx","1061","site_id","// Removed: site_id resolution - single-tenant architecture"
"src\hooks\useAccounting.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useAccounting.ts","35","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","64","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","85","site_id","...accountData,  // CRITICAL: Include site_id"
"src\hooks\useAccounting.ts","115","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","158","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","204","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","263","site_id",".insert({  // CRITICAL: Include site_id"
"src\hooks\useAccounting.ts","279","site_id","journal_entry_id: headerData.id,  // CRITICAL: Include site_id"
"src\hooks\useAccounting.ts","296","site_id","await supabase.from('journal_entries').delete().eq('id', headerData.id).eq('site_id', siteId);"
"src\hooks\useAccounting.ts","327","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","372","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","435","site_id",".insert({  // CRITICAL: Include site_id"
"src\hooks\useAccounting.ts","455","site_id","bill_id: billData.id,  // CRITICAL: Include site_id"
"src\hooks\useAccounting.ts","473","site_id","await supabase.from('bills').delete().eq('id', billData.id).eq('site_id', siteId);"
"src\hooks\useAccounting.ts","504","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","537","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","573","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","611","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","638","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","683","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAPIKeys.ts","15","site_id","site_id: string;"
"src\hooks\useAPIKeys.ts","72","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","80","site_id","site_id,"
"src\hooks\useAPIKeys.ts","119","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","165","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","193","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","202","site_id",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","221","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","227","site_id",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","252","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","261","site_id",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","332","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","342","site_id","query = query.eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","380","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","413","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAuditLog.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useAuditLog.ts","61","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAuditLog.ts","113","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCompanyData.tsx","35","site_id",".eq('site_id', siteId) // ? Add site filter"
"src\hooks\useCrewGPSCheckin.ts","4","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useCrewGPSCheckin.ts","83","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCrewGPSCheckin.ts","101","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCrewGPSCheckin.ts","184","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCRM.ts","4","site_id","* These hooks ensure proper site_id and company_id filtering for all CRM operations."
"src\hooks\useCRM.ts","66","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","111","site_id","if (!siteId || !leadId) throw new Error('Missing site_id or lead_id');"
"src\hooks\useCRM.ts","132","site_id","mutationFn: async (lead: Omit<LeadInsert, 'site_id'>) => {"
"src\hooks\useCRM.ts","133","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","160","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","189","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","195","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","228","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","291","site_id","mutationFn: async (contact: Omit<ContactInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","292","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","320","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","351","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","391","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","457","site_id","mutationFn: async (opportunity: Omit<OpportunityInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","458","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","486","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","517","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","556","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","619","site_id","mutationFn: async (deal: Omit<DealInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","620","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","648","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","679","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","716","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","772","site_id","mutationFn: async (campaign: Omit<EmailCampaignInsert, 'site_id'>) => {"
"src\hooks\useCRM.ts","773","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","800","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","829","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","835","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","867","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","903","site_id","mutationFn: async (template: Omit<EmailTemplateInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","904","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","932","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","962","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","999","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1056","site_id","mutationFn: async (workflow: Omit<WorkflowDefinitionInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","1057","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1085","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1116","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1155","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1194","site_id","mutationFn: async (activity: Omit<CRMActivityInsert, 'site_id' | 'company_id'>) => {"
"src\hooks\useCRM.ts","1195","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1223","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1253","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1296","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1302","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1435","site_id","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1473","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1507","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1534","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1540","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1565","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1592","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1598","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1619","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1635","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1652","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1661","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1668","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1695","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1722","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1728","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1749","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1789","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1814","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1841","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1847","site_id",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1880","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1966","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1979","site_id","supabase.from('leads').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1980","site_id","supabase.from('contacts').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1981","site_id","supabase.from('opportunities').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1982","site_id","supabase.from('deals').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useDailyReportTemplates.ts","60","site_id","// Query templates for company with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","79","site_id","// Query template task presets with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","81","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useDailyReportTemplates.ts","93","site_id","// Create template mutation with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","132","site_id","// Update template mutation with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","166","site_id","// Delete template mutation with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","240","site_id","// Add task presets to template with site_id isolation"
"src\hooks\useDailyReportTemplates.ts","264","site_id","// Delete task preset with site_id isolation"
"src\hooks\useDashboardData.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useDashboardData.ts","102","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.ts","114","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","81","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","91","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","101","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDigitalInspections.ts","8","site_id","site_id: string;"
"src\hooks\useDigitalInspections.ts","34","site_id","// Fetch inspections with site_id and company_id isolation"
"src\hooks\useDigitalInspections.ts","57","site_id","// Create inspection with site_id and company_id isolation"
"src\hooks\useDigitalInspections.ts","89","site_id","// Update inspection with site_id isolation"
"src\hooks\useDigitalInspections.ts","117","site_id","// Delete inspection with site_id isolation"
"src\hooks\useEquipmentQRScanning.ts","70","site_id","// Query equipment with QR codes with site_id isolation"
"src\hooks\useEquipmentQRScanning.ts","76","site_id","// Note: equipment_with_qr view should be filtered by site_id via RLS"
"src\hooks\useEquipmentQRScanning.ts","90","site_id","// Query recent scan events with site_id isolation"
"src\hooks\useEquipmentQRScanning.ts","96","site_id","// Note: recent_equipment_scans view should be filtered by site_id via RLS"
"src\hooks\useFinancialSettings.ts","9","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useFinancialSettings.ts","24","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","55","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","76","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","111","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useFinancialSettings.ts","126","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useImageProcessor.ts","48","site_id","site_id: string;"
"src\hooks\useImageProcessor.ts","61","site_id","site_id: string;"
"src\hooks\useImageProcessor.ts","122","site_id","throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","161","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","186","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","210","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","239","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","301","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","327","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","358","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","364","site_id",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","383","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","389","site_id",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","397","site_id",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","458","site_id","throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","135","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","165","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","200","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","229","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","258","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","287","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","316","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","349","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","408","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","442","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","480","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","485","site_id",".eq('site_id', siteId);"
"src\hooks\useLeadInsights.ts","525","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","14","site_id","site_id: string;"
"src\hooks\useMarketingCampaigns.ts","204","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","251","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","275","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","327","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","358","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","364","site_id",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","389","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","398","site_id",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","423","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","484","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","491","site_id",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","530","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","537","site_id",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","586","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","617","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","675","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","712","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","744","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","808","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","829","site_id",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","885","site_id","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useOfflineSync.ts","304","site_id","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","309","site_id","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","316","site_id","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","321","site_id","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","328","site_id","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","333","site_id","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","340","site_id","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","345","site_id","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","35","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","89","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","130","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","161","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","167","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","174","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","181","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","251","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","278","site_id","...projectData,  // CRITICAL: Include site_id on insert"
"src\hooks\useOptimizedQueries.ts","315","site_id","project_id: projectId,  // CRITICAL: Include site_id on insert"
"src\hooks\useOptimizedQueries.ts","356","site_id","...invoiceData,  // CRITICAL: Include site_id on insert"
"src\hooks\useOptimizedQueries.ts","403","site_id","filter: `site_id=eq.${siteId}`,  // CRITICAL: Filter by site_id"
"src\hooks\useOptimizedQueries.ts","427","site_id","filter: `site_id=eq.${siteId}`,  // CRITICAL: Filter by site_id"
"src\hooks\useRealtimeChat.ts","48","site_id","// Load channels for the company with site_id isolation"
"src\hooks\useRealtimeChat.ts","53","site_id","// Get channels user is member of with site_id isolation"
"src\hooks\useRealtimeChat.ts","88","site_id","// Load messages for a specific channel with site_id isolation"
"src\hooks\useRealtimeChat.ts","111","site_id","// Mark messages as read with site_id isolation"
"src\hooks\useRealtimeChat.ts","130","site_id","// Send a message with site_id isolation"
"src\hooks\useRealtimeChat.ts","160","site_id","// Send a file message with site_id isolation"
"src\hooks\useRealtimeChat.ts","183","site_id","// Create message with file and site_id"
"src\hooks\useRealtimeChat.ts","210","site_id","// Create a new channel with site_id isolation"
"src\hooks\useRealtimeChat.ts","231","site_id","// Add creator as admin member with site_id"
"src\hooks\useRealtimeChat.ts","253","site_id","// Set up real-time subscriptions with site_id isolation"
"src\hooks\useRealtimeChat.ts","257","site_id","// Subscribe to new messages - filter by site_id and company_id"
"src\hooks\useRealtimeChat.ts","266","site_id","filter: `site_id=eq.${siteId}`"
"src\hooks\useRealtimeChat.ts","297","site_id","// Subscribe to channel updates - filter by site_id"
"src\hooks\useRealtimeChat.ts","306","site_id","filter: `site_id=eq.${siteId}`"
"src\hooks\useRealTimeSync.ts","117","site_id","// CRITICAL: Site isolation - filter by site_id AND company_id"
"src\hooks\useRealTimeSync.ts","118","site_id","filter: `site_id=eq.${siteId},company_id=eq.${userProfile.company_id}`"
"src\hooks\useSupabaseQuery.ts","97","site_id","// Apply filters (including site_id for tenant isolation)"
"src\hooks\useTasks.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useTimesheetApproval.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\hooks\useTimesheetApproval.ts","58","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","77","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","99","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","117","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","141","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation on update"
"src\hooks\useTimesheetApproval.ts","182","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation on update"
"src\hooks\useVideoUpload.ts","72","site_id","if (!siteId) throw new Error('No site_id available');"
"src\integrations\supabase\types.ts","1694","site_id","site_id: string"
"src\integrations\supabase\types.ts","1711","site_id","site_id: string"
"src\integrations\supabase\types.ts","1728","site_id","site_id?: string"
"src\integrations\supabase\types.ts","1734","site_id","foreignKeyName: ""api_keys_site_id_fkey"""
"src\integrations\supabase\types.ts","1735","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","1812","site_id","site_id: string"
"src\integrations\supabase\types.ts","1831","site_id","site_id: string"
"src\integrations\supabase\types.ts","1850","site_id","site_id?: string"
"src\integrations\supabase\types.ts","1863","site_id","foreignKeyName: ""appointments_site_id_fkey"""
"src\integrations\supabase\types.ts","1864","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","1900","site_id","site_id: string"
"src\integrations\supabase\types.ts","1934","site_id","site_id: string"
"src\integrations\supabase\types.ts","1968","site_id","site_id?: string"
"src\integrations\supabase\types.ts","1976","site_id","foreignKeyName: ""audit_logs_site_id_fkey"""
"src\integrations\supabase\types.ts","1977","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","4087","site_id","site_id: string"
"src\integrations\supabase\types.ts","4104","site_id","site_id: string"
"src\integrations\supabase\types.ts","4121","site_id","site_id?: string"
"src\integrations\supabase\types.ts","4129","site_id","foreignKeyName: ""blog_posts_site_id_fkey"""
"src\integrations\supabase\types.ts","4130","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","5311","site_id","site_id: string"
"src\integrations\supabase\types.ts","5334","site_id","site_id: string"
"src\integrations\supabase\types.ts","5357","site_id","site_id?: string"
"src\integrations\supabase\types.ts","5392","site_id","foreignKeyName: ""change_orders_site_id_fkey"""
"src\integrations\supabase\types.ts","5393","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","6317","site_id","site_id: string"
"src\integrations\supabase\types.ts","6338","site_id","site_id: string"
"src\integrations\supabase\types.ts","6359","site_id","site_id?: string"
"src\integrations\supabase\types.ts","6372","site_id","foreignKeyName: ""companies_site_id_fkey"""
"src\integrations\supabase\types.ts","6373","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","8577","site_id","site_id: string"
"src\integrations\supabase\types.ts","8604","site_id","site_id: string"
"src\integrations\supabase\types.ts","8631","site_id","site_id?: string"
"src\integrations\supabase\types.ts","8644","site_id","foreignKeyName: ""daily_report_templates_site_id_fkey"""
"src\integrations\supabase\types.ts","8645","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","8674","site_id","site_id: string"
"src\integrations\supabase\types.ts","8706","site_id","site_id: string"
"src\integrations\supabase\types.ts","8738","site_id","site_id?: string"
"src\integrations\supabase\types.ts","8779","site_id","foreignKeyName: ""daily_reports_site_id_fkey"""
"src\integrations\supabase\types.ts","8780","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","9756","site_id","site_id: string"
"src\integrations\supabase\types.ts","9782","site_id","site_id: string"
"src\integrations\supabase\types.ts","9808","site_id","site_id?: string"
"src\integrations\supabase\types.ts","9879","site_id","foreignKeyName: ""documents_site_id_fkey"""
"src\integrations\supabase\types.ts","9880","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","10070","site_id","site_id: string"
"src\integrations\supabase\types.ts","10109","site_id","site_id: string"
"src\integrations\supabase\types.ts","10148","site_id","site_id?: string"
"src\integrations\supabase\types.ts","10167","site_id","foreignKeyName: ""email_campaigns_site_id_fkey"""
"src\integrations\supabase\types.ts","10168","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","12315","site_id","site_id: string"
"src\integrations\supabase\types.ts","12335","site_id","site_id: string"
"src\integrations\supabase\types.ts","12355","site_id","site_id?: string"
"src\integrations\supabase\types.ts","12395","site_id","foreignKeyName: ""equipment_qr_codes_site_id_fkey"""
"src\integrations\supabase\types.ts","12396","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","13176","site_id","site_id: string"
"src\integrations\supabase\types.ts","13206","site_id","site_id: string"
"src\integrations\supabase\types.ts","13236","site_id","site_id?: string"
"src\integrations\supabase\types.ts","13304","site_id","foreignKeyName: ""estimates_site_id_fkey"""
"src\integrations\supabase\types.ts","13305","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","13368","site_id","site_id: string"
"src\integrations\supabase\types.ts","13391","site_id","site_id: string"
"src\integrations\supabase\types.ts","13414","site_id","site_id?: string"
"src\integrations\supabase\types.ts","13436","site_id","foreignKeyName: ""expenses_site_id_fkey"""
"src\integrations\supabase\types.ts","13437","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","16027","site_id","site_id: string"
"src\integrations\supabase\types.ts","16071","site_id","site_id: string"
"src\integrations\supabase\types.ts","16115","site_id","site_id?: string"
"src\integrations\supabase\types.ts","16157","site_id","foreignKeyName: ""invoices_site_id_fkey"""
"src\integrations\supabase\types.ts","16158","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","17983","site_id","site_id: string"
"src\integrations\supabase\types.ts","18035","site_id","site_id: string"
"src\integrations\supabase\types.ts","18087","site_id","site_id?: string"
"src\integrations\supabase\types.ts","18101","site_id","foreignKeyName: ""leads_site_id_fkey"""
"src\integrations\supabase\types.ts","18102","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","21714","site_id","site_id: string | null"
"src\integrations\supabase\types.ts","21724","site_id","site_id?: string | null"
"src\integrations\supabase\types.ts","21734","site_id","site_id?: string | null"
"src\integrations\supabase\types.ts","21747","site_id","foreignKeyName: ""profiles_site_id_fkey"""
"src\integrations\supabase\types.ts","21748","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","23134","site_id","site_id: string"
"src\integrations\supabase\types.ts","23146","site_id","site_id: string"
"src\integrations\supabase\types.ts","23158","site_id","site_id?: string"
"src\integrations\supabase\types.ts","23191","site_id","foreignKeyName: ""project_templates_site_id_fkey"""
"src\integrations\supabase\types.ts","23192","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","23222","site_id","site_id: string"
"src\integrations\supabase\types.ts","23253","site_id","site_id: string"
"src\integrations\supabase\types.ts","23284","site_id","site_id?: string"
"src\integrations\supabase\types.ts","23309","site_id","foreignKeyName: ""projects_site_id_fkey"""
"src\integrations\supabase\types.ts","23310","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27333","site_id","site_id: string"
"src\integrations\supabase\types.ts","27346","site_id","site_id: string"
"src\integrations\supabase\types.ts","27359","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27365","site_id","foreignKeyName: ""seo_ai_insights_site_id_fkey"""
"src\integrations\supabase\types.ts","27366","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27391","site_id","site_id: string"
"src\integrations\supabase\types.ts","27416","site_id","site_id: string"
"src\integrations\supabase\types.ts","27441","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27458","site_id","foreignKeyName: ""seo_alert_rules_site_id_fkey"""
"src\integrations\supabase\types.ts","27459","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27492","site_id","site_id: string"
"src\integrations\supabase\types.ts","27522","site_id","site_id: string"
"src\integrations\supabase\types.ts","27552","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27580","site_id","foreignKeyName: ""seo_alerts_site_id_fkey"""
"src\integrations\supabase\types.ts","27581","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27598","site_id","site_id: string"
"src\integrations\supabase\types.ts","27611","site_id","site_id: string"
"src\integrations\supabase\types.ts","27624","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27630","site_id","foreignKeyName: ""seo_analytics_site_id_fkey"""
"src\integrations\supabase\types.ts","27631","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27659","site_id","site_id: string"
"src\integrations\supabase\types.ts","27684","site_id","site_id: string"
"src\integrations\supabase\types.ts","27709","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27723","site_id","foreignKeyName: ""seo_audit_history_site_id_fkey"""
"src\integrations\supabase\types.ts","27724","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27750","site_id","site_id: string"
"src\integrations\supabase\types.ts","27779","site_id","site_id: string"
"src\integrations\supabase\types.ts","27808","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27828","site_id","foreignKeyName: ""seo_backlinks_site_id_fkey"""
"src\integrations\supabase\types.ts","27829","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27857","site_id","site_id: string"
"src\integrations\supabase\types.ts","27883","site_id","site_id: string"
"src\integrations\supabase\types.ts","27909","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27924","site_id","foreignKeyName: ""seo_competitor_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","27925","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","27946","site_id","site_id: string"
"src\integrations\supabase\types.ts","27967","site_id","site_id: string"
"src\integrations\supabase\types.ts","27988","site_id","site_id?: string"
"src\integrations\supabase\types.ts","27998","site_id","foreignKeyName: ""seo_configurations_site_id_fkey"""
"src\integrations\supabase\types.ts","27999","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28035","site_id","site_id: string"
"src\integrations\supabase\types.ts","28072","site_id","site_id: string"
"src\integrations\supabase\types.ts","28109","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28127","site_id","foreignKeyName: ""seo_content_briefs_site_id_fkey"""
"src\integrations\supabase\types.ts","28128","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28186","site_id","site_id: string"
"src\integrations\supabase\types.ts","28246","site_id","site_id: string"
"src\integrations\supabase\types.ts","28306","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28325","site_id","foreignKeyName: ""seo_content_optimization_site_id_fkey"""
"src\integrations\supabase\types.ts","28326","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28358","site_id","site_id: string"
"src\integrations\supabase\types.ts","28390","site_id","site_id: string"
"src\integrations\supabase\types.ts","28422","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28453","site_id","foreignKeyName: ""seo_content_performance_site_id_fkey"""
"src\integrations\supabase\types.ts","28454","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28478","site_id","site_id: string"
"src\integrations\supabase\types.ts","28503","site_id","site_id: string"
"src\integrations\supabase\types.ts","28528","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28546","site_id","foreignKeyName: ""seo_content_templates_site_id_fkey"""
"src\integrations\supabase\types.ts","28547","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28581","site_id","site_id: string"
"src\integrations\supabase\types.ts","28614","site_id","site_id: string"
"src\integrations\supabase\types.ts","28647","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28663","site_id","foreignKeyName: ""seo_core_web_vitals_site_id_fkey"""
"src\integrations\supabase\types.ts","28664","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28706","site_id","site_id: string"
"src\integrations\supabase\types.ts","28746","site_id","site_id: string"
"src\integrations\supabase\types.ts","28786","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28808","site_id","foreignKeyName: ""seo_crawl_results_site_id_fkey"""
"src\integrations\supabase\types.ts","28809","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28839","site_id","site_id: string"
"src\integrations\supabase\types.ts","28865","site_id","site_id: string"
"src\integrations\supabase\types.ts","28891","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28904","site_id","foreignKeyName: ""seo_duplicate_content_site_id_fkey"""
"src\integrations\supabase\types.ts","28905","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","28928","site_id","site_id: string"
"src\integrations\supabase\types.ts","28949","site_id","site_id: string"
"src\integrations\supabase\types.ts","28970","site_id","site_id?: string"
"src\integrations\supabase\types.ts","28992","site_id","foreignKeyName: ""seo_fixes_applied_site_id_fkey"""
"src\integrations\supabase\types.ts","28993","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29024","site_id","site_id: string"
"src\integrations\supabase\types.ts","29050","site_id","site_id: string"
"src\integrations\supabase\types.ts","29076","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29095","site_id","foreignKeyName: ""seo_image_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","29096","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29125","site_id","site_id: string"
"src\integrations\supabase\types.ts","29151","site_id","site_id: string"
"src\integrations\supabase\types.ts","29177","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29191","site_id","foreignKeyName: ""seo_insights_site_id_fkey"""
"src\integrations\supabase\types.ts","29192","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29213","site_id","site_id: string"
"src\integrations\supabase\types.ts","29229","site_id","site_id: string"
"src\integrations\supabase\types.ts","29245","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29257","site_id","foreignKeyName: ""seo_keyword_history_site_id_fkey"""
"src\integrations\supabase\types.ts","29258","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29287","site_id","site_id: string"
"src\integrations\supabase\types.ts","29313","site_id","site_id: string"
"src\integrations\supabase\types.ts","29339","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29353","site_id","foreignKeyName: ""seo_keywords_site_id_fkey"""
"src\integrations\supabase\types.ts","29354","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29379","site_id","site_id: string"
"src\integrations\supabase\types.ts","29402","site_id","site_id: string"
"src\integrations\supabase\types.ts","29425","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29447","site_id","foreignKeyName: ""seo_link_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","29448","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29470","site_id","site_id: string"
"src\integrations\supabase\types.ts","29491","site_id","site_id: string"
"src\integrations\supabase\types.ts","29512","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29521","site_id","foreignKeyName: ""seo_meta_tags_site_id_fkey"""
"src\integrations\supabase\types.ts","29522","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29556","site_id","site_id: string"
"src\integrations\supabase\types.ts","29589","site_id","site_id: string"
"src\integrations\supabase\types.ts","29622","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29638","site_id","foreignKeyName: ""seo_mobile_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","29639","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29661","site_id","site_id: string"
"src\integrations\supabase\types.ts","29678","site_id","site_id: string"
"src\integrations\supabase\types.ts","29695","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29707","site_id","foreignKeyName: ""seo_monitoring_log_site_id_fkey"""
"src\integrations\supabase\types.ts","29708","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29740","site_id","site_id: string"
"src\integrations\supabase\types.ts","29770","site_id","site_id: string"
"src\integrations\supabase\types.ts","29800","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29815","site_id","foreignKeyName: ""seo_monitoring_schedules_site_id_fkey"""
"src\integrations\supabase\types.ts","29816","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29845","site_id","site_id: string"
"src\integrations\supabase\types.ts","29873","site_id","site_id: string"
"src\integrations\supabase\types.ts","29901","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29917","site_id","foreignKeyName: ""seo_notification_preferences_site_id_fkey"""
"src\integrations\supabase\types.ts","29918","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29933","site_id","site_id: string"
"src\integrations\supabase\types.ts","29943","site_id","site_id: string"
"src\integrations\supabase\types.ts","29953","site_id","site_id?: string"
"src\integrations\supabase\types.ts","29958","site_id","foreignKeyName: ""seo_oauth_tokens_site_id_fkey"""
"src\integrations\supabase\types.ts","29959","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","29988","site_id","site_id: string"
"src\integrations\supabase\types.ts","30017","site_id","site_id: string"
"src\integrations\supabase\types.ts","30046","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30063","site_id","foreignKeyName: ""seo_page_scores_site_id_fkey"""
"src\integrations\supabase\types.ts","30064","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30104","site_id","site_id: string"
"src\integrations\supabase\types.ts","30139","site_id","site_id: string"
"src\integrations\supabase\types.ts","30174","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30186","site_id","foreignKeyName: ""seo_performance_budget_site_id_fkey"""
"src\integrations\supabase\types.ts","30187","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30211","site_id","site_id: string"
"src\integrations\supabase\types.ts","30232","site_id","site_id: string"
"src\integrations\supabase\types.ts","30253","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30274","site_id","foreignKeyName: ""seo_performance_budget_violations_site_id_fkey"""
"src\integrations\supabase\types.ts","30275","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30301","site_id","site_id: string"
"src\integrations\supabase\types.ts","30323","site_id","site_id: string"
"src\integrations\supabase\types.ts","30345","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30358","site_id","foreignKeyName: ""seo_redirect_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","30359","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30389","site_id","site_id: string"
"src\integrations\supabase\types.ts","30419","site_id","site_id: string"
"src\integrations\supabase\types.ts","30449","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30466","site_id","foreignKeyName: ""seo_security_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","30467","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30496","site_id","site_id: string"
"src\integrations\supabase\types.ts","30527","site_id","site_id: string"
"src\integrations\supabase\types.ts","30558","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30591","site_id","foreignKeyName: ""seo_semantic_analysis_site_id_fkey"""
"src\integrations\supabase\types.ts","30592","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30623","site_id","site_id: string"
"src\integrations\supabase\types.ts","30650","site_id","site_id: string"
"src\integrations\supabase\types.ts","30677","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30697","site_id","foreignKeyName: ""seo_serp_positions_site_id_fkey"""
"src\integrations\supabase\types.ts","30698","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30728","site_id","site_id: string"
"src\integrations\supabase\types.ts","30757","site_id","site_id: string"
"src\integrations\supabase\types.ts","30786","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30802","site_id","foreignKeyName: ""seo_settings_site_id_fkey"""
"src\integrations\supabase\types.ts","30803","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30831","site_id","site_id: string"
"src\integrations\supabase\types.ts","30858","site_id","site_id: string"
"src\integrations\supabase\types.ts","30885","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30908","site_id","foreignKeyName: ""seo_structured_data_site_id_fkey"""
"src\integrations\supabase\types.ts","30909","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","30923","site_id","site_id: string"
"src\integrations\supabase\types.ts","30936","site_id","site_id: string"
"src\integrations\supabase\types.ts","30949","site_id","site_id?: string"
"src\integrations\supabase\types.ts","30958","site_id","foreignKeyName: ""seo_submissions_site_id_fkey"""
"src\integrations\supabase\types.ts","30959","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","31568","site_id","site_id: string"
"src\integrations\supabase\types.ts","31580","site_id","site_id: string"
"src\integrations\supabase\types.ts","31592","site_id","site_id?: string"
"src\integrations\supabase\types.ts","31598","site_id","foreignKeyName: ""service_categories_site_id_fkey"""
"src\integrations\supabase\types.ts","31599","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","31621","site_id","site_id: string"
"src\integrations\supabase\types.ts","31639","site_id","site_id: string"
"src\integrations\supabase\types.ts","31657","site_id","site_id?: string"
"src\integrations\supabase\types.ts","31670","site_id","foreignKeyName: ""services_site_id_fkey"""
"src\integrations\supabase\types.ts","31671","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","33812","site_id","site_id: string"
"src\integrations\supabase\types.ts","33844","site_id","site_id: string"
"src\integrations\supabase\types.ts","33876","site_id","site_id?: string"
"src\integrations\supabase\types.ts","33922","site_id","foreignKeyName: ""tasks_site_id_fkey"""
"src\integrations\supabase\types.ts","33923","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","34484","site_id","site_id: string"
"src\integrations\supabase\types.ts","34514","site_id","site_id: string"
"src\integrations\supabase\types.ts","34544","site_id","site_id?: string"
"src\integrations\supabase\types.ts","34590","site_id","foreignKeyName: ""time_entries_site_id_fkey"""
"src\integrations\supabase\types.ts","34591","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","36390","site_id","site_id: string"
"src\integrations\supabase\types.ts","36406","site_id","site_id: string"
"src\integrations\supabase\types.ts","36422","site_id","site_id?: string"
"src\integrations\supabase\types.ts","36435","site_id","foreignKeyName: ""user_profiles_site_id_fkey"""
"src\integrations\supabase\types.ts","36436","site_id","columns: [""site_id""]"
"src\integrations\supabase\types.ts","39479","site_id","current_site_id: { Args: never; Returns: string }"
"src\pages\admin\AdminIntelligenceDashboard.tsx","216","site_id",".eq('site_id', userProfile?.site_id || '');"
"src\pages\Safety.tsx","196","site_id",".eq('site_id', siteId),"
"src\pages\Setup.tsx","150","site_id","// Update user profile with company_id and ensure site_id is set"
"src\services\auditService.ts","71","site_id","p_site_id: params.siteId,"
"src\services\auditService.ts","114","site_id","p_site_id: params.siteId,"
"src\services\estimateService.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\services\estimateService.ts","21","site_id","site_id?: string;"
"src\services\estimateService.ts","54","site_id",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","145","site_id",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","188","site_id",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","210","site_id",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\services\estimateToProjectConversion.ts","56","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","122","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","210","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\services\materialToPurchaseOrderService.ts","54","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","77","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","169","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","209","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","290","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"src\services\projectService.ts","24","site_id","site_id?: string;"
"src\services\projectService.ts","88","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","114","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","151","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","173","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","204","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","242","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","266","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","285","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","72","site_id","* Get tasks with multi-tenant site_id isolation"
"src\services\taskService.ts","95","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","125","site_id","* Get a single task with multi-tenant site_id isolation"
"src\services\taskService.ts","135","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","148","site_id","? supabase.from('projects').select('id, name, site_id').eq('id', task.project_id).maybeSingle()"
"src\services\taskService.ts","153","site_id","? supabase.from('user_profiles').select('id, first_name, last_name, email, site_id').in('id', userIds)"
"src\services\taskService.ts","173","site_id","* Create a task with multi-tenant site_id isolation"
"src\services\taskService.ts","186","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","213","site_id","* Update a task with multi-tenant site_id isolation"
"src\services\taskService.ts","224","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","237","site_id","* Delete a task with multi-tenant site_id isolation"
"src\services\taskService.ts","247","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","256","site_id","* Get task comments with multi-tenant site_id isolation"
"src\services\taskService.ts","269","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","281","site_id","* Add task comment with multi-tenant site_id isolation"
"src\services\taskService.ts","313","site_id","* Get tasks assigned to current user with multi-tenant site_id isolation"
"src\services\taskService.ts","330","site_id","* Get tasks created by current user with multi-tenant site_id isolation"
"src\services\taskService.ts","343","site_id",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","371","site_id","? supabase.from('projects').select('id, name, site_id').in('id', projectIds)"
"src\services\taskService.ts","374","site_id","? supabase.from('user_profiles').select('id, first_name, last_name, email, site_id').in('id', userIds)"
"src\components\estimates\ConvertToProjectDialog.tsx","75","siteId","if (!estimateId || !siteId) return;"
"src\components\estimates\ConvertToProjectDialog.tsx","79","siteId","const preview = await estimateConversionService.getConversionPreview(siteId, estimateId);"
"src\components\estimates\ConvertToProjectDialog.tsx","105","siteId","if (!estimateId || !userProfile?.company_id || !siteId || !canConvert) return;"
"src\components\estimates\ConvertToProjectDialog.tsx","119","siteId","siteId,  // CRITICAL: Site isolation"
"src\components\materials\CreatePOFromMaterialDialog.tsx","87","siteId","if (!siteId) return;"
"src\components\materials\CreatePOFromMaterialDialog.tsx","91","siteId","const preview = await materialToPOService.getPOPreview(siteId, materialIds);"
"src\components\materials\CreatePOFromMaterialDialog.tsx","118","siteId","if (!userProfile?.company_id || !siteId) return;"
"src\components\materials\CreatePOFromMaterialDialog.tsx","122","siteId","siteId,  // CRITICAL: Site isolation"
"src\components\materials\CreatePOFromMaterialDialog.tsx","132","siteId","if (!userProfile?.company_id || !user?.id || !siteId || !canCreate) return;"
"src\components\materials\CreatePOFromMaterialDialog.tsx","156","siteId","siteId,  // CRITICAL: Site isolation"
"src\components\onboarding\OnboardingFlow.tsx","90","siteId","const { user, siteId, userProfile } = useAuth();"
"src\components\onboarding\OnboardingFlow.tsx","248","siteId","// Validate siteId is available (required for multi-tenant isolation)"
"src\components\onboarding\OnboardingFlow.tsx","249","siteId","if (!siteId) {"
"src\components\onboarding\OnboardingFlow.tsx","270","siteId","// Multi-tenant scoping - use resolved siteId from AuthContext"
"src\components\reports\CustomReportBuilder.tsx","221","siteId","if (!siteId) {"
"src\components\reports\CustomReportBuilder.tsx","228","siteId","query = supabase.from('projects').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","231","siteId","query = supabase.from('job_costs').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","234","siteId","query = supabase.from('time_entries').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","237","siteId","query = supabase.from('expenses').select('*').eq('site_id', siteId);"
"src\components\reports\CustomReportBuilder.tsx","240","siteId","query = supabase.from('invoices').select('*').eq('site_id', siteId);"
"src\contexts\AuthContext.tsx","134","siteId","// Removed: siteId and siteConfig - single-tenant architecture"
"src\contexts\AuthContext.tsx","877","siteId","setSiteId(null);"
"src\hooks\__tests__\useSessionRefresh.test.ts","63","siteId","getCurrentSiteId: vi.fn().mockReturnValue('test-site-id'),"
"src\hooks\useAccounting.ts","25","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","28","siteId","queryKey: ['chart-of-accounts', companyId, siteId],"
"src\hooks\useAccounting.ts","30","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","35","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","48","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","53","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","56","siteId","queryKey: ['account', accountId, siteId],"
"src\hooks\useAccounting.ts","58","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","64","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","70","siteId","enabled: !!accountId && !!siteId,"
"src\hooks\useAccounting.ts","76","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","80","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","105","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","109","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","115","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","142","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","145","siteId","queryKey: ['journal-entries', companyId, filters, siteId],"
"src\hooks\useAccounting.ts","147","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","158","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","182","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","187","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","190","siteId","queryKey: ['journal-entry', entryId, siteId],"
"src\hooks\useAccounting.ts","192","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","204","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","210","siteId","enabled: !!entryId && !!siteId,"
"src\hooks\useAccounting.ts","216","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","234","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","296","siteId","await supabase.from('journal_entries').delete().eq('id', headerData.id).eq('site_id', siteId);"
"src\hooks\useAccounting.ts","314","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","318","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","327","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","355","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","358","siteId","queryKey: ['bills', companyId, filters, siteId],"
"src\hooks\useAccounting.ts","360","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","372","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","392","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","398","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","419","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","473","siteId","await supabase.from('bills').delete().eq('id', billData.id).eq('site_id', siteId);"
"src\hooks\useAccounting.ts","494","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","497","siteId","queryKey: ['fiscal-periods', companyId, fiscalYearId, siteId],"
"src\hooks\useAccounting.ts","499","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","504","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","520","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","525","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","528","siteId","queryKey: ['current-fiscal-period', companyId, siteId],"
"src\hooks\useAccounting.ts","530","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","537","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","546","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","555","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","558","siteId","queryKey: ['account-balances', companyId, fiscalPeriodId, siteId],"
"src\hooks\useAccounting.ts","560","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","573","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","589","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","598","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","601","siteId","queryKey: ['bank-accounts', companyId, siteId],"
"src\hooks\useAccounting.ts","603","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","611","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","619","siteId","enabled: !!companyId && !!siteId,"
"src\hooks\useAccounting.ts","628","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","631","siteId","queryKey: ['bank-transactions', bankAccountId, filters, siteId],"
"src\hooks\useAccounting.ts","633","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","638","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","659","siteId","enabled: !!bankAccountId && !!siteId,"
"src\hooks\useAccounting.ts","668","siteId","const { siteId } = useAuth();"
"src\hooks\useAccounting.ts","671","siteId","queryKey: ['trial-balance', companyId, asOfDate, siteId],"
"src\hooks\useAccounting.ts","673","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useAccounting.ts","683","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAccounting.ts","689","siteId","enabled: !!companyId && !!asOfDate && !!siteId,"
"src\hooks\useAPIKeys.ts","70","siteId","queryKey: ['api-keys', siteId],"
"src\hooks\useAPIKeys.ts","72","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","106","siteId","enabled: !!siteId && !!user && (options?.enabled !== false),"
"src\hooks\useAPIKeys.ts","119","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","160","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","165","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","188","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","193","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","202","siteId",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","216","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","221","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","227","siteId",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","241","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","252","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","261","siteId",".eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","275","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","280","siteId","if (!siteId || !keyId) throw new Error('Missing required parameters');"
"src\hooks\useAPIKeys.ts","318","siteId","enabled: !!siteId && !!keyId && (options?.enabled !== false),"
"src\hooks\useAPIKeys.ts","327","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","330","siteId","queryKey: ['api-key-stats', siteId, keyId],"
"src\hooks\useAPIKeys.ts","332","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","342","siteId","query = query.eq('site_id', siteId);"
"src\hooks\useAPIKeys.ts","368","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useAPIKeys.ts","380","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","408","siteId","const { siteId } = useAuth();"
"src\hooks\useAPIKeys.ts","411","siteId","queryKey: ['sensitive-data-access-log', siteId, options?.limit],"
"src\hooks\useAPIKeys.ts","413","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useAPIKeys.ts","424","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useAuditLog.ts","49","siteId","if (!user || !siteId) return null;"
"src\hooks\useAuditLog.ts","61","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useAuditLog.ts","101","siteId","if (!user || !siteId) return null;"
"src\hooks\useAuditLog.ts","113","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useBiometricLogin.ts","126","siteId","if (!siteId) {"
"src\hooks\useBiometricLogin.ts","149","siteId","siteId,"
"src\hooks\useBiometricLogin.ts","171","siteId","}, [user, siteId, trustCurrentDevice]);"
"src\hooks\useCompanyData.tsx","22","siteId","if (!userProfile?.company_id || !siteId) {"
"src\hooks\useCompanyData.tsx","35","siteId",".eq('site_id', siteId) // ? Add site filter"
"src\hooks\useCompanyData.tsx","49","siteId","}, [userProfile?.company_id, siteId]);"
"src\hooks\useCrewGPSCheckin.ts","76","siteId","queryKey: ['crew-pending-checkin', user?.id, siteId],"
"src\hooks\useCrewGPSCheckin.ts","78","siteId","if (!user?.id || !siteId) return [];"
"src\hooks\useCrewGPSCheckin.ts","83","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCrewGPSCheckin.ts","89","siteId","enabled: !!user?.id && !!siteId,"
"src\hooks\useCrewGPSCheckin.ts","94","siteId","queryKey: ['crew-presence', siteId],"
"src\hooks\useCrewGPSCheckin.ts","96","siteId","if (!siteId) return [];"
"src\hooks\useCrewGPSCheckin.ts","101","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCrewGPSCheckin.ts","108","siteId","enabled: !!siteId,"
"src\hooks\useCrewGPSCheckin.ts","170","siteId","if (!siteId) {"
"src\hooks\useCrewGPSCheckin.ts","184","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useCRM.ts","61","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","64","siteId","queryKey: ['leads', siteId, filters],"
"src\hooks\useCRM.ts","66","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","100","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","106","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","109","siteId","queryKey: ['lead', leadId, siteId],"
"src\hooks\useCRM.ts","111","siteId","if (!siteId || !leadId) throw new Error('Missing site_id or lead_id');"
"src\hooks\useCRM.ts","122","siteId","enabled: !!siteId && !!leadId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","128","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","133","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","155","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","160","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","184","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","189","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","195","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","226","siteId","queryKey: ['contacts', siteId, companyId, filters],"
"src\hooks\useCRM.ts","228","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","256","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","266","siteId","queryKey: ['contact', contactId, siteId, companyId],"
"src\hooks\useCRM.ts","268","siteId","if (!siteId || !companyId || !contactId) throw new Error('Missing required IDs');"
"src\hooks\useCRM.ts","280","siteId","enabled: !!siteId && !!companyId && !!contactId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","292","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","320","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","351","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","389","siteId","queryKey: ['opportunities', siteId, companyId, filters],"
"src\hooks\useCRM.ts","391","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","422","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","432","siteId","queryKey: ['opportunity', opportunityId, siteId, companyId],"
"src\hooks\useCRM.ts","434","siteId","if (!siteId || !companyId || !opportunityId) throw new Error('Missing required IDs');"
"src\hooks\useCRM.ts","446","siteId","enabled: !!siteId && !!companyId && !!opportunityId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","458","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","486","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","517","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","554","siteId","queryKey: ['deals', siteId, companyId, filters],"
"src\hooks\useCRM.ts","556","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","584","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","594","siteId","queryKey: ['deal', dealId, siteId, companyId],"
"src\hooks\useCRM.ts","596","siteId","if (!siteId || !companyId || !dealId) throw new Error('Missing required IDs');"
"src\hooks\useCRM.ts","608","siteId","enabled: !!siteId && !!companyId && !!dealId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","620","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","648","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","679","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","711","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","714","siteId","queryKey: ['email_campaigns', siteId, filters],"
"src\hooks\useCRM.ts","716","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","740","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","746","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","749","siteId","queryKey: ['email_campaign', campaignId, siteId],"
"src\hooks\useCRM.ts","751","siteId","if (!siteId || !campaignId) throw new Error('Missing required IDs');"
"src\hooks\useCRM.ts","762","siteId","enabled: !!siteId && !!campaignId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","768","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","773","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","795","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","800","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","824","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","829","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","835","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","865","siteId","queryKey: ['email_templates', siteId, companyId, filters],"
"src\hooks\useCRM.ts","867","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","892","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","904","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","932","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","962","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","997","siteId","queryKey: ['workflow_definitions', siteId, companyId, filters],"
"src\hooks\useCRM.ts","999","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1021","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1031","siteId","queryKey: ['workflow_definition', workflowId, siteId, companyId],"
"src\hooks\useCRM.ts","1033","siteId","if (!siteId || !companyId || !workflowId) throw new Error('Missing required IDs');"
"src\hooks\useCRM.ts","1045","siteId","enabled: !!siteId && !!companyId && !!workflowId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1057","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1085","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1116","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1153","siteId","queryKey: ['crm_activities', siteId, companyId, filters],"
"src\hooks\useCRM.ts","1155","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1183","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1195","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1223","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1253","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1294","siteId","queryKey: ['pipeline_stats', siteId, companyId],"
"src\hooks\useCRM.ts","1296","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1302","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1358","siteId","enabled: !!siteId && !!companyId && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1389","siteId","queryKey: ['lead_score', leadId, siteId],"
"src\hooks\useCRM.ts","1391","siteId","if (!siteId || !leadId || !session?.access_token) {"
"src\hooks\useCRM.ts","1412","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1435","siteId","if (!siteId || !companyId) throw new Error('No site_id or company_id available');"
"src\hooks\useCRM.ts","1473","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1496","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1507","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1529","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1534","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1540","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1560","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1565","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1587","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1592","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1598","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1614","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1619","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1635","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1652","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1661","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1668","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1690","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1695","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1717","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1722","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1728","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1749","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1789","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1809","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1814","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1836","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1841","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1847","siteId",".eq('site_id', siteId);"
"src\hooks\useCRM.ts","1875","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1878","siteId","queryKey: ['crm-search', siteId, query],"
"src\hooks\useCRM.ts","1880","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1952","siteId","enabled: !!siteId && !!query && query.length >= 2 && (options?.enabled !== false),"
"src\hooks\useCRM.ts","1961","siteId","const { siteId } = useAuth();"
"src\hooks\useCRM.ts","1964","siteId","queryKey: ['crm-dashboard-stats', siteId],"
"src\hooks\useCRM.ts","1966","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useCRM.ts","1979","siteId","supabase.from('leads').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1980","siteId","supabase.from('contacts').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1981","siteId","supabase.from('opportunities').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","1982","siteId","supabase.from('deals').select('*', { count: 'exact', head: true }).eq('site_id', siteId),"
"src\hooks\useCRM.ts","2004","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useDailyReportTemplates.ts","62","siteId","queryKey: ['daily-report-templates', userProfile?.company_id, siteId],"
"src\hooks\useDailyReportTemplates.ts","64","siteId","if (!userProfile?.company_id || !siteId) return [];"
"src\hooks\useDailyReportTemplates.ts","76","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useDailyReportTemplates.ts","81","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useDailyReportTemplates.ts","99","siteId","if (!siteId) {"
"src\hooks\useDailyReportTemplates.ts","135","siteId","if (!siteId) throw new Error('Site ID not found');"
"src\hooks\useDailyReportTemplates.ts","169","siteId","if (!siteId) throw new Error('Site ID not found');"
"src\hooks\useDailyReportTemplates.ts","247","siteId","if (!siteId) throw new Error('Site ID not found');"
"src\hooks\useDailyReportTemplates.ts","266","siteId","if (!siteId) throw new Error('Site ID not found');"
"src\hooks\useDashboardData.ts","89","siteId","if (!userProfile?.company_id || !siteId) {"
"src\hooks\useDashboardData.ts","102","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.ts","114","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.ts","171","siteId","}, [userProfile?.company_id, siteId]);"
"src\hooks\useDashboardData.ts","174","siteId","if (userProfile?.company_id && siteId) {"
"src\hooks\useDashboardData.tsx","68","siteId","if (!userProfile?.company_id || !siteId) {"
"src\hooks\useDashboardData.tsx","81","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","91","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","101","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useDashboardData.tsx","162","siteId","}, [userProfile?.company_id, siteId, toast]);"
"src\hooks\useDeviceTrust.ts","241","siteId","}, [user, siteId, getCurrentDeviceId, generateDeviceFingerprint, parseUserAgent, loadTrustedDevices]);"
"src\hooks\useDigitalInspections.ts","36","siteId","queryKey: ['quality-inspections', projectId, siteId, userProfile?.company_id],"
"src\hooks\useDigitalInspections.ts","38","siteId","if (!siteId || !userProfile?.company_id) return [];"
"src\hooks\useDigitalInspections.ts","54","siteId","enabled: !!siteId && !!userProfile?.company_id,"
"src\hooks\useDigitalInspections.ts","60","siteId","if (!siteId || !userProfile?.company_id) {"
"src\hooks\useDigitalInspections.ts","92","siteId","if (!siteId) throw new Error('Site ID required');"
"src\hooks\useDigitalInspections.ts","120","siteId","if (!siteId) throw new Error('Site ID required');"
"src\hooks\useEquipmentQRScanning.ts","72","siteId","queryKey: ['equipment-with-qr', userProfile?.company_id, siteId],"
"src\hooks\useEquipmentQRScanning.ts","74","siteId","if (!userProfile?.company_id || !siteId) return [];"
"src\hooks\useEquipmentQRScanning.ts","87","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useEquipmentQRScanning.ts","92","siteId","queryKey: ['recent-equipment-scans', userProfile?.company_id, siteId],"
"src\hooks\useEquipmentQRScanning.ts","94","siteId","if (!userProfile?.company_id || !siteId) return [];"
"src\hooks\useEquipmentQRScanning.ts","105","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useFinancialSettings.ts","17","siteId","queryKey: ['financial-settings', userProfile?.company_id, siteId],"
"src\hooks\useFinancialSettings.ts","19","siteId","if (!userProfile?.company_id || !siteId) return DEFAULT_FINANCIAL_SETTINGS;"
"src\hooks\useFinancialSettings.ts","24","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","42","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useFinancialSettings.ts","49","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useFinancialSettings.ts","55","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","76","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","85","siteId","queryClient.invalidateQueries({ queryKey: ['financial-settings', userProfile?.company_id, siteId] });"
"src\hooks\useFinancialSettings.ts","118","siteId","queryKey: ['project-costs', projectId, settings, siteId],"
"src\hooks\useFinancialSettings.ts","120","siteId","if (!userProfile?.company_id || !projectId || !siteId) return null;"
"src\hooks\useFinancialSettings.ts","126","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useFinancialSettings.ts","146","siteId","enabled: !!projectId && !!userProfile?.company_id && !!siteId,"
"src\hooks\useImageProcessor.ts","121","siteId","if (!siteId) {"
"src\hooks\useImageProcessor.ts","129","siteId","siteId,"
"src\hooks\useImageProcessor.ts","156","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","159","siteId","queryKey: ['processing-queue', siteId],"
"src\hooks\useImageProcessor.ts","161","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","172","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useImageProcessor.ts","181","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","184","siteId","queryKey: ['processing-queue-count', siteId],"
"src\hooks\useImageProcessor.ts","186","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","196","siteId","enabled: !!siteId,"
"src\hooks\useImageProcessor.ts","205","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","208","siteId","queryKey: ['processed-images', siteId, documentId],"
"src\hooks\useImageProcessor.ts","210","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","226","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useImageProcessor.ts","234","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","237","siteId","queryKey: ['processed-image', siteId, originalPath],"
"src\hooks\useImageProcessor.ts","239","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","250","siteId","enabled: !!siteId && !!originalPath && (options?.enabled !== false),"
"src\hooks\useImageProcessor.ts","296","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","301","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","322","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","327","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","353","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","358","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","364","siteId",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","378","siteId","const { siteId } = useAuth();"
"src\hooks\useImageProcessor.ts","381","siteId","queryKey: ['image-processing-stats', siteId],"
"src\hooks\useImageProcessor.ts","383","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useImageProcessor.ts","389","siteId",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","397","siteId",".eq('site_id', siteId);"
"src\hooks\useImageProcessor.ts","426","siteId","enabled: !!siteId,"
"src\hooks\useImageProcessor.ts","457","siteId","if (!siteId) {"
"src\hooks\useLeadInsights.ts","133","siteId","queryKey: ['lead-score', siteId, leadId],"
"src\hooks\useLeadInsights.ts","135","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","151","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","165","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","184","siteId","queryClient.setQueryData(['lead-score', siteId, score.lead_id], score);"
"src\hooks\useLeadInsights.ts","198","siteId","queryKey: ['lead-insights', siteId, leadId],"
"src\hooks\useLeadInsights.ts","200","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","216","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","227","siteId","queryKey: ['lead-recommendations', siteId, leadId],"
"src\hooks\useLeadInsights.ts","229","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","245","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","256","siteId","queryKey: ['lead-predictions', siteId, leadId],"
"src\hooks\useLeadInsights.ts","258","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","274","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","285","siteId","queryKey: ['engagement-analysis', siteId, leadId],"
"src\hooks\useLeadInsights.ts","287","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","303","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","314","siteId","queryKey: ['similar-leads', siteId, leadId, options?.limit],"
"src\hooks\useLeadInsights.ts","316","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","333","siteId","enabled: !!siteId && !!leadId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","344","siteId","const { siteId } = useAuth();"
"src\hooks\useLeadInsights.ts","347","siteId","queryKey: ['lead-activity-timeline', siteId, leadId, options?.days],"
"src\hooks\useLeadInsights.ts","349","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","395","siteId","enabled: !!siteId && !!leadId && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","406","siteId","queryKey: ['lead-comparison', siteId, leadIds],"
"src\hooks\useLeadInsights.ts","408","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","426","siteId","!!siteId &&"
"src\hooks\useLeadInsights.ts","440","siteId","queryKey: ['pipeline-health', siteId],"
"src\hooks\useLeadInsights.ts","442","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","466","siteId","enabled: !!siteId && !!session?.access_token && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","475","siteId","const { siteId } = useAuth();"
"src\hooks\useLeadInsights.ts","478","siteId","queryKey: ['score-distribution', siteId],"
"src\hooks\useLeadInsights.ts","480","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","485","siteId",".eq('site_id', siteId);"
"src\hooks\useLeadInsights.ts","512","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useLeadInsights.ts","525","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useLeadInsights.ts","543","siteId","queryClient.setQueryData(['lead-score', siteId, score.lead_id], score);"
"src\hooks\useLeadInsights.ts","544","siteId","queryClient.invalidateQueries({ queryKey: ['lead-insights', siteId, score.lead_id] });"
"src\hooks\useLeadInsights.ts","545","siteId","queryClient.invalidateQueries({ queryKey: ['score-distribution', siteId] });"
"src\hooks\useMarketingCampaigns.ts","199","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","202","siteId","queryKey: ['marketing-campaigns', siteId, filters],"
"src\hooks\useMarketingCampaigns.ts","204","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","238","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","246","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","249","siteId","queryKey: ['marketing-campaign', siteId, campaignId],"
"src\hooks\useMarketingCampaigns.ts","251","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","262","siteId","enabled: !!siteId && !!campaignId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","275","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","316","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","327","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","344","siteId","queryClient.invalidateQueries({ queryKey: ['marketing-campaign', siteId, data.id] });"
"src\hooks\useMarketingCampaigns.ts","353","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","358","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","364","siteId",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","378","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","389","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","398","siteId",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","423","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","479","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","482","siteId","queryKey: ['campaign-stats', siteId],"
"src\hooks\useMarketingCampaigns.ts","484","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","491","siteId",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","517","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","525","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","528","siteId","queryKey: ['campaign-performance', siteId, campaignId],"
"src\hooks\useMarketingCampaigns.ts","530","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","537","siteId",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","570","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","581","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","584","siteId","queryKey: ['campaign-email-sends', siteId, campaignId, options?.status],"
"src\hooks\useMarketingCampaigns.ts","586","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","604","siteId","enabled: !!siteId && !!campaignId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","612","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","615","siteId","queryKey: ['email-sequences', siteId],"
"src\hooks\useMarketingCampaigns.ts","617","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","657","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","675","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","699","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","712","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","739","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","742","siteId","queryKey: ['campaign-ab-tests', siteId, campaignId],"
"src\hooks\useMarketingCampaigns.ts","744","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","781","siteId","enabled: !!siteId && !!campaignId && (options?.enabled !== false),"
"src\hooks\useMarketingCampaigns.ts","808","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","829","siteId",".eq('site_id', siteId);"
"src\hooks\useMarketingCampaigns.ts","880","siteId","const { siteId } = useAuth();"
"src\hooks\useMarketingCampaigns.ts","883","siteId","queryKey: ['unsubscribe-stats', siteId],"
"src\hooks\useMarketingCampaigns.ts","885","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useMarketingCampaigns.ts","911","siteId","enabled: !!siteId && (options?.enabled !== false),"
"src\hooks\useOfflineSync.ts","35","siteId","const { siteId } = useAuth();"
"src\hooks\useOfflineSync.ts","304","siteId","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","309","siteId","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","316","siteId","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","321","siteId","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","328","siteId","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","333","siteId","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOfflineSync.ts","340","siteId","if (!siteId) throw new Error('No site_id available for sync');"
"src\hooks\useOfflineSync.ts","345","siteId","site_id: siteId  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","15","siteId","queryKey: [...queryKeys.projects, siteId],"
"src\hooks\useOptimizedQueries.ts","18","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","35","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","42","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useOptimizedQueries.ts","55","siteId","queryKey: [...queryKeys.project(projectId), siteId],"
"src\hooks\useOptimizedQueries.ts","58","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","89","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","100","siteId","enabled: !!userProfile?.company_id && !!projectId && !!siteId,"
"src\hooks\useOptimizedQueries.ts","113","siteId","queryKey: [...queryKeys.invoices, siteId],"
"src\hooks\useOptimizedQueries.ts","116","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","130","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","138","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useOptimizedQueries.ts","151","siteId","queryKey: [...queryKeys.dashboardData, siteId],"
"src\hooks\useOptimizedQueries.ts","154","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","161","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","167","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","174","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","181","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","220","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useOptimizedQueries.ts","233","siteId","queryKey: [...queryKeys.opportunities, siteId],"
"src\hooks\useOptimizedQueries.ts","236","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","251","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useOptimizedQueries.ts","258","siteId","enabled: !!userProfile?.company_id && !!siteId,"
"src\hooks\useOptimizedQueries.ts","273","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","289","siteId","queryClient.setQueryData([...queryKeys.projects, siteId], (old: any[] = []) => [data, ...old]);"
"src\hooks\useOptimizedQueries.ts","290","siteId","queryClient.setQueryData([...queryKeys.project(data.id), siteId], data);"
"src\hooks\useOptimizedQueries.ts","309","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","326","siteId","queryClient.setQueryData([...queryKeys.project(variables.projectId), siteId], (old: any) => {"
"src\hooks\useOptimizedQueries.ts","351","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useOptimizedQueries.ts","367","siteId","queryClient.setQueryData([...queryKeys.invoices, siteId], (old: any[] = []) => [data, ...old]);"
"src\hooks\useOptimizedQueries.ts","390","siteId","if (!userProfile?.company_id || !siteId) return;"
"src\hooks\useOptimizedQueries.ts","403","siteId","filter: `site_id=eq.${siteId}`,  // CRITICAL: Filter by site_id"
"src\hooks\useOptimizedQueries.ts","427","siteId","filter: `site_id=eq.${siteId}`,  // CRITICAL: Filter by site_id"
"src\hooks\useOptimizedQueries.ts","447","siteId","}, [userProfile?.company_id, siteId, queryClient]);"
"src\hooks\useRealtimeChat.ts","50","siteId","if (!userProfile?.company_id || !siteId) return;"
"src\hooks\useRealtimeChat.ts","86","siteId","}, [userProfile, siteId, toast]);"
"src\hooks\useRealtimeChat.ts","90","siteId","if (!userProfile || !siteId) return;"
"src\hooks\useRealtimeChat.ts","128","siteId","}, [userProfile, siteId, toast]);"
"src\hooks\useRealtimeChat.ts","132","siteId","if (!userProfile || !activeChannel || !content.trim() || !siteId) return;"
"src\hooks\useRealtimeChat.ts","158","siteId","}, [userProfile, activeChannel, siteId, toast]);"
"src\hooks\useRealtimeChat.ts","162","siteId","if (!userProfile || !activeChannel || !siteId) return;"
"src\hooks\useRealtimeChat.ts","208","siteId","}, [userProfile, activeChannel, siteId, toast]);"
"src\hooks\useRealtimeChat.ts","212","siteId","if (!userProfile || !siteId) return;"
"src\hooks\useRealtimeChat.ts","251","siteId","}, [userProfile, siteId, loadChannels, toast]);"
"src\hooks\useRealtimeChat.ts","255","siteId","if (!userProfile || !siteId) return;"
"src\hooks\useRealtimeChat.ts","266","siteId","filter: `site_id=eq.${siteId}`"
"src\hooks\useRealtimeChat.ts","306","siteId","filter: `site_id=eq.${siteId}`"
"src\hooks\useRealtimeChat.ts","318","siteId","}, [userProfile, siteId, activeChannel, loadChannels]);"
"src\hooks\useRealTimeSync.ts","99","siteId","if (!userProfile?.company_id || !siteId) return;"
"src\hooks\useRealTimeSync.ts","118","siteId","filter: `site_id=eq.${siteId},company_id=eq.${userProfile.company_id}`"
"src\hooks\useRealTimeSync.ts","137","siteId","}, [userProfile?.company_id, siteId, subscriptions, handleSyncEvent]);"
"src\hooks\useTasks.ts","4","siteId","* Now passes siteId to taskService for complete isolation"
"src\hooks\useTasks.ts","18","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","21","siteId","queryKey: ['tasks', filters, siteId],"
"src\hooks\useTasks.ts","23","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","24","siteId","return taskService.getTasks(siteId, filters);  // Pass siteId to service"
"src\hooks\useTasks.ts","27","siteId","enabled: !!siteId,"
"src\hooks\useTasks.ts","32","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","35","siteId","queryKey: ['task', id, siteId],"
"src\hooks\useTasks.ts","37","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","38","siteId","return taskService.getTask(siteId, id);  // Pass siteId to service"
"src\hooks\useTasks.ts","40","siteId","enabled: !!id && !!siteId,"
"src\hooks\useTasks.ts","45","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","48","siteId","queryKey: ['my-tasks', status, siteId],"
"src\hooks\useTasks.ts","50","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","51","siteId","return taskService.getMyTasks(siteId, status);  // Pass siteId to service"
"src\hooks\useTasks.ts","55","siteId","enabled: !!siteId,"
"src\hooks\useTasks.ts","60","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","63","siteId","queryKey: ['tasks-created-by-me', status, siteId],"
"src\hooks\useTasks.ts","65","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","66","siteId","return taskService.getTasksCreatedByMe(siteId, status);  // Pass siteId to service"
"src\hooks\useTasks.ts","70","siteId","enabled: !!siteId,"
"src\hooks\useTasks.ts","75","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","80","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","81","siteId","return taskService.createTask(siteId, taskData);  // Pass siteId to service"
"src\hooks\useTasks.ts","103","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","108","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","109","siteId","return taskService.updateTask(siteId, id, updates);  // Pass siteId to service"
"src\hooks\useTasks.ts","132","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","137","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","138","siteId","return taskService.deleteTask(siteId, id);  // Pass siteId to service"
"src\hooks\useTasks.ts","160","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","163","siteId","queryKey: ['task-comments', taskId, siteId],"
"src\hooks\useTasks.ts","165","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","166","siteId","return taskService.getTaskComments(siteId, taskId);  // Pass siteId to service"
"src\hooks\useTasks.ts","168","siteId","enabled: !!taskId && !!siteId,"
"src\hooks\useTasks.ts","173","siteId","const { siteId } = useAuth();"
"src\hooks\useTasks.ts","178","siteId","if (!siteId) throw new Error('Site ID is required');"
"src\hooks\useTasks.ts","179","siteId","return taskService.addTaskComment(siteId, taskId, comment);  // Pass siteId to service"
"src\hooks\useTimesheetApproval.ts","45","siteId","const { siteId } = useAuth();"
"src\hooks\useTimesheetApproval.ts","51","siteId","queryKey: ['pending-timesheets', siteId],"
"src\hooks\useTimesheetApproval.ts","53","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","58","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","65","siteId","enabled: !!siteId,"
"src\hooks\useTimesheetApproval.ts","70","siteId","queryKey: ['approved-timesheets', siteId],"
"src\hooks\useTimesheetApproval.ts","72","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","77","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","83","siteId","enabled: !!siteId,"
"src\hooks\useTimesheetApproval.ts","88","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","99","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","109","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","117","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\useTimesheetApproval.ts","128","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","141","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation on update"
"src\hooks\useTimesheetApproval.ts","150","siteId","queryClient.invalidateQueries({ queryKey: ['pending-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","151","siteId","queryClient.invalidateQueries({ queryKey: ['approved-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","169","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","182","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation on update"
"src\hooks\useTimesheetApproval.ts","191","siteId","queryClient.invalidateQueries({ queryKey: ['pending-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","192","siteId","queryClient.invalidateQueries({ queryKey: ['approved-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","210","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","225","siteId","queryClient.invalidateQueries({ queryKey: ['pending-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","226","siteId","queryClient.invalidateQueries({ queryKey: ['approved-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","245","siteId","if (!siteId) throw new Error('No site ID - multi-tenant isolation required');"
"src\hooks\useTimesheetApproval.ts","260","siteId","queryClient.invalidateQueries({ queryKey: ['pending-timesheets', siteId] });"
"src\hooks\useTimesheetApproval.ts","261","siteId","queryClient.invalidateQueries({ queryKey: ['approved-timesheets', siteId] });"
"src\hooks\useUnifiedBiometric.ts","231","siteId","if (!user || !siteId) {"
"src\hooks\useUnifiedBiometric.ts","243","siteId","siteId,"
"src\hooks\useUnifiedBiometric.ts","285","siteId","}, [user, siteId, state.environment]);"
"src\hooks\useVideoUpload.ts","70","siteId","queryKey: ['upload_config', siteId, companyId, fileCategory],"
"src\hooks\useVideoUpload.ts","72","siteId","if (!siteId) throw new Error('No site_id available');"
"src\hooks\useVideoUpload.ts","83","siteId","enabled: !!siteId,"
"src\hooks\useVideoUpload.ts","208","siteId","if (!siteId || !companyId) {"
"src\hooks\useVideoUpload.ts","360","siteId","queryKey: ['project_videos', projectId, siteId, companyId],"
"src\hooks\useVideoUpload.ts","362","siteId","if (!siteId || !companyId || !projectId) {"
"src\hooks\useVideoUpload.ts","379","siteId","enabled: !!siteId && !!companyId && !!projectId,"
"src\hooks\useVideoUpload.ts","393","siteId","if (!siteId || !companyId) {"
"src\pages\Safety.tsx","196","siteId",".eq('site_id', siteId),"
"src\pages\Setup.tsx","65","siteId","// Validate siteId is available (required for multi-tenant isolation)"
"src\pages\Setup.tsx","66","siteId","if (!siteId) {"
"src\pages\Setup.tsx","83","siteId","siteId,"
"src\services\auditService.ts","13","siteId","siteId: string;"
"src\services\auditService.ts","29","siteId","siteId: string;"
"src\services\auditService.ts","62","siteId","if (!params.siteId || !params.userId || !params.companyId) {"
"src\services\auditService.ts","71","siteId","p_site_id: params.siteId,"
"src\services\auditService.ts","105","siteId","if (!params.siteId || !params.userId || !params.companyId) {"
"src\services\auditService.ts","114","siteId","p_site_id: params.siteId,"
"src\services\auditService.ts","145","siteId","siteId: string,"
"src\services\auditService.ts","168","siteId","siteId: string,"
"src\services\auditService.ts","209","siteId","siteId: string,"
"src\services\BiometricAuthService.ts","47","siteId","siteId: string;"
"src\services\BiometricAuthService.ts","198","siteId","siteId: string;"
"src\services\CapacitorBiometricService.ts","51","siteId","siteId: string;"
"src\services\estimateService.ts","4","siteId","* All methods require siteId as first parameter for complete isolation"
"src\services\estimateService.ts","45","siteId","async getEstimates(siteId: string, companyId?: string): Promise<Estimate[]> {"
"src\services\estimateService.ts","46","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateService.ts","54","siteId",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","71","siteId","async getEstimateStats(siteId: string, companyId?: string): Promise<EstimateStats> {"
"src\services\estimateService.ts","72","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateService.ts","74","siteId","const estimates = await this.getEstimates(siteId, companyId);"
"src\services\estimateService.ts","130","siteId","async createEstimate(siteId: string, estimateData: {"
"src\services\estimateService.ts","140","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateService.ts","145","siteId",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","182","siteId","async updateEstimate(siteId: string, estimateId: string, updates: Partial<Estimate>): Promise<Estimate> {"
"src\services\estimateService.ts","183","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateService.ts","188","siteId",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateService.ts","204","siteId","async deleteEstimate(siteId: string, estimateId: string): Promise<void> {"
"src\services\estimateService.ts","205","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateService.ts","210","siteId",".eq(""site_id"", siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","4","siteId","* All methods require siteId as first parameter for complete isolation"
"src\services\estimateToProjectConversion.ts","44","siteId","siteId: string,"
"src\services\estimateToProjectConversion.ts","49","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateToProjectConversion.ts","56","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","107","siteId","siteId,"
"src\services\estimateToProjectConversion.ts","122","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\estimateToProjectConversion.ts","159","siteId","siteId: string,"
"src\services\estimateToProjectConversion.ts","199","siteId","async getConversionPreview(siteId: string, estimateId: string): Promise<{"
"src\services\estimateToProjectConversion.ts","204","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\estimateToProjectConversion.ts","210","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","4","siteId","* All methods require siteId as first parameter for complete isolation"
"src\services\materialToPurchaseOrderService.ts","41","siteId","siteId: string,"
"src\services\materialToPurchaseOrderService.ts","47","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\materialToPurchaseOrderService.ts","54","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","77","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","169","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","194","siteId","async getPOPreview(siteId: string, materialIds: string[]): Promise<{"
"src\services\materialToPurchaseOrderService.ts","200","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\materialToPurchaseOrderService.ts","209","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\materialToPurchaseOrderService.ts","283","siteId","async getSuggestedVendors(siteId: string, companyId: string, category?: string): Promise<any[]> {"
"src\services\materialToPurchaseOrderService.ts","284","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\materialToPurchaseOrderService.ts","290","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","4","siteId","* All methods require siteId as first parameter for complete isolation"
"src\services\projectService.ts","74","siteId","async getProjects(siteId: string, companyId?: string): Promise<ProjectWithRelations[]> {"
"src\services\projectService.ts","75","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","88","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","100","siteId","async getProject(siteId: string, projectId: string, companyId?: string): Promise<ProjectWithRelations | null> {"
"src\services\projectService.ts","101","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","114","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","128","siteId","async createProject(siteId: string, projectData: CreateProjectData): Promise<Project> {"
"src\services\projectService.ts","129","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","145","siteId","async updateProject(siteId: string, projectId: string, updates: Partial<Project>, companyId?: string): Promise<Project> {"
"src\services\projectService.ts","146","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","151","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","167","siteId","async deleteProject(siteId: string, projectId: string, companyId?: string): Promise<void> {"
"src\services\projectService.ts","168","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","173","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","186","siteId","async getProjectStats(siteId: string, companyId?: string): Promise<ProjectStats> {"
"src\services\projectService.ts","187","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","204","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","224","siteId","async updateProjectCompletion(siteId: string, projectId: string, percentage: number, companyId?: string): Promise<void> {"
"src\services\projectService.ts","225","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","242","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","255","siteId","async searchProjects(siteId: string, searchTerm: string, companyId?: string): Promise<ProjectWithRelations[]> {"
"src\services\projectService.ts","256","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","266","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","279","siteId","async getProjectsByStatus(siteId: string, status: string, companyId?: string): Promise<Project[]> {"
"src\services\projectService.ts","280","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","285","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\projectService.ts","298","siteId","async duplicateProject(siteId: string, projectId: string, newName: string, companyId?: string): Promise<Project> {"
"src\services\projectService.ts","299","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\projectService.ts","301","siteId","const original = await this.getProject(siteId, projectId, companyId);"
"src\services\projectService.ts","314","siteId","return this.createProject(siteId, duplicateData);"
"src\services\taskService.ts","73","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","76","siteId","async getTasks(siteId: string, filters?: {"
"src\services\taskService.ts","82","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","95","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","126","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","129","siteId","async getTask(siteId: string, id: string): Promise<TaskWithDetails | null> {"
"src\services\taskService.ts","130","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","135","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","174","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","177","siteId","async createTask(siteId: string, taskData: CreateTaskData): Promise<Task> {"
"src\services\taskService.ts","178","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","186","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","214","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","218","siteId","async updateTask(siteId: string, id: string, updates: UpdateTaskData): Promise<Task> {"
"src\services\taskService.ts","219","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","224","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","238","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","241","siteId","async deleteTask(siteId: string, id: string): Promise<void> {"
"src\services\taskService.ts","242","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","247","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","257","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","260","siteId","async getTaskComments(siteId: string, taskId: string) {"
"src\services\taskService.ts","261","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","269","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\services\taskService.ts","282","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","286","siteId","async addTaskComment(siteId: string, taskId: string, comment: string) {"
"src\services\taskService.ts","287","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","314","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","317","siteId","async getMyTasks(siteId: string, status?: string[]): Promise<TaskWithDetails[]> {"
"src\services\taskService.ts","318","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","323","siteId","return this.getTasks(siteId, {"
"src\services\taskService.ts","331","siteId","* @param siteId - REQUIRED: Site ID for multi-tenant isolation"
"src\services\taskService.ts","334","siteId","async getTasksCreatedByMe(siteId: string, status?: string[]): Promise<TaskWithDetails[]> {"
"src\services\taskService.ts","335","siteId","if (!siteId) throw new Error('Site ID is required for multi-tenant isolation');"
"src\services\taskService.ts","343","siteId",".eq('site_id', siteId)  // CRITICAL: Site isolation"
"src\hooks\__tests__\useSessionRefresh.test.ts","57","getSiteConfig","getSiteConfig: vi.fn().mockResolvedValue({"
"src\hooks\__tests__\useSessionRefresh.test.ts","63","getCurrentSiteId","getCurrentSiteId: vi.fn().mockReturnValue('test-site-id'),"
"src\contexts\AuthContext.tsx","17","site-resolver","// Site-resolver removed - single-tenant architecture"
"src\hooks\__tests__\useSessionRefresh.test.ts","56","site-resolver","vi.mock('@/lib/site-resolver', () => ({"
"supabase\functions\analyze-support-ticket\index.ts","62","site_id",".select(""*, site_id"")"
"supabase\functions\analyze-support-ticket\index.ts","328","site_id","userQuery = userQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","352","site_id","companyQuery = companyQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","366","site_id","healthQuery = healthQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","380","site_id","activityQuery = activityQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","392","site_id","settingsQuery = settingsQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","406","site_id","pastTicketsQuery = pastTicketsQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","516","site_id","articlesQuery = articlesQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","551","site_id","insertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","567","site_id","updateQuery = updateQuery.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\analyze-support-ticket\index.ts","586","site_id","upsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","590","site_id","onConflict: siteId ? 'ticket_id,site_id' : 'ticket_id'"
"supabase\functions\api-auth\index.ts","14","site_id","site_id: string"
"supabase\functions\api-auth\index.ts","184","site_id","site_id: apiKey.site_id,"
"supabase\functions\api-management\index.ts","13","site_id","site_id?: string;"
"supabase\functions\api-management\index.ts","78","site_id",".select('site_id, company_id, permissions, rate_limit_per_hour, is_active, expires_at')"
"supabase\functions\api-management\index.ts","100","site_id","site_id: keyData.site_id,"
"supabase\functions\api-management\index.ts","356","site_id",".eq('site_id', validation.site_id)"
"supabase\functions\api-management\index.ts","381","site_id","site_id: validation.site_id,"
"supabase\functions\api-management\index.ts","423","site_id",".eq('site_id', validation.site_id)"
"supabase\functions\api-management\index.ts","456","site_id",".eq('site_id', validation.site_id)"
"supabase\functions\api-management\index.ts","481","site_id","site_id?: string;"
"supabase\functions\api-management\index.ts","502","site_id",".select('site_id, company_id, permissions, is_active, expires_at')"
"supabase\functions\api-management\index.ts","540","site_id","site_id: keyData.site_id,"
"supabase\functions\auto-intervention-scheduler\index.ts","150","site_id",".eq(""site_id"", site.id);  // CRITICAL: Site isolation"
"supabase\functions\auto-intervention-scheduler\index.ts","162","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\auto-intervention-scheduler\index.ts","180","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\auto-intervention-scheduler\index.ts","200","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\auto-intervention-scheduler\index.ts","212","site_id","site_id: site.id,  // CRITICAL: Site isolation"
"supabase\functions\blog-ai-automation\index.ts","80","site_id","const { action, topic, customSettings, site_id, site_key } = body;"
"supabase\functions\blog-ai-automation\index.ts","81","site_id","logStep(""Request parsed"", { action, topic, authMethod, site_id, site_key });"
"supabase\functions\blog-ai-automation\index.ts","83","site_id","let siteId = site_id;"
"supabase\functions\calculate-bid-analytics\index.ts","123","site_id","onConflict: 'site_id,company_id,analysis_period,period_start,period_end'"
"supabase\functions\calculate-health-scores\index.ts","15","site_id","site_id: string;"
"supabase\functions\calculate-health-scores\index.ts","68","site_id",".eq(""site_id"", site.id);  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","120","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","129","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","137","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","147","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","155","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-health-scores\index.ts","183","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\calculate-revenue-metrics\index.ts","71","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\calculate-revenue-metrics\index.ts","115","site_id","site_id: site.id,  // CRITICAL: Site isolation"
"supabase\functions\calculate-revenue-metrics\index.ts","131","site_id","onConflict: 'site_id,period_start,period_end'"
"supabase\functions\calculate-revenue-metrics\index.ts","181","site_id",".eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\change-orders\index.ts","61","site_id","projects!inner(name, client_name, company_id, site_id)"
"supabase\functions\change-orders\index.ts","95","site_id","projects!inner(name, client_name, company_id, site_id)"
"supabase\functions\change-orders\index.ts","151","site_id","site_id: siteId          };"
"supabase\functions\change-orders\index.ts","182","site_id","site_id: siteId            }));"
"supabase\functions\check-subscription\index.ts","141","site_id","upsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\check-subscription\index.ts","145","site_id","onConflict: siteId ? 'email,site_id' : 'email'"
"supabase\functions\check-subscription\index.ts","209","site_id","subscriptionUpsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\check-subscription\index.ts","213","site_id","onConflict: siteId ? 'email,site_id' : 'email'"
"supabase\functions\convert-trial-to-paid\index.ts","195","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\create-missing-content\index.ts","16","site_id","let siteId = body.site_id;"
"supabase\functions\create-missing-content\index.ts","26","site_id","JSON.stringify({ error: 'BuildDesk site not found. Please provide site_id.' }),"
"supabase\functions\create-stripe-checkout\index.ts","139","site_id","updateQuery = updateQuery.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\crm-email-automation\index.ts","7","site_id","* - Multi-tenant site_id isolation"
"supabase\functions\cron-social-scheduler\index.ts","61","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\cron-social-scheduler\index.ts","92","site_id","site_id: site.id,                manual_trigger: false, // This is a scheduled trigger"
"supabase\functions\cron-social-scheduler\index.ts","114","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation on update"
"supabase\functions\daily-reports\index.ts","55","site_id","projects!inner(name, company_id, site_id)"
"supabase\functions\daily-reports\index.ts","87","site_id","projects!inner(name, company_id, site_id)"
"supabase\functions\daily-reports\index.ts","128","site_id","site_id: siteId          };"
"supabase\functions\enhanced-blog-ai\index.ts","991","site_id","site_id: siteId  // CRITICAL: Site isolation"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","23","site_id","const { topic, company_id, queue_id, action, customSettings, site_id, site_key } = body;"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","37","site_id","let siteId = site_id || customSettings?.site_id;"
"supabase\functions\execute-workflow\index.ts","65","site_id",".select('*, site_id')      .eq('id', workflowId)"
"supabase\functions\execute-workflow\index.ts","88","site_id","stepInsertData.site_id = siteId  // CRITICAL: Site isolation"
"supabase\functions\generate-1099s\index.ts","148","site_id","onConflict: 'site_id,contractor_id,tax_year',"
"supabase\functions\generate-churn-predictions\index.ts","51","site_id",".eq(""site_id"", site.id);  // CRITICAL: Site isolation"
"supabase\functions\generate-churn-predictions\index.ts","122","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\generate-churn-predictions\index.ts","127","site_id","site_id: site.id,  // CRITICAL: Site isolation"
"supabase\functions\generate-churn-predictions\index.ts","143","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\google-calendar-callback\index.ts","110","site_id","onConflict: 'site_id,company_id,provider,account_email'  // Updated conflict resolution"
"supabase\functions\handle-demo-request\index.ts","26","site_id","site_id?: string;    site_key?: string; // Optional site_key from request"
"supabase\functions\handle-demo-request\index.ts","50","site_id","let siteId = requestData.site_id;"
"supabase\functions\image-processor\index.ts","383","site_id","site_id: options.company_id: options.companyId,"
"supabase\functions\ml-lead-scoring\index.ts","80","site_id","site_id: string;"
"supabase\functions\ml-lead-scoring\index.ts","195","site_id",".select('site_id, company_id')"
"supabase\functions\ml-lead-scoring\index.ts","199","site_id","if (!userProfile?.site_id) {"
"supabase\functions\outlook-calendar-callback\index.ts","110","site_id","onConflict: 'site_id,company_id,provider,account_email'  // Updated conflict resolution"
"supabase\functions\process-blog-generation-queue\index.ts","46","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-blog-generation-queue\index.ts","79","site_id","site_id: site.id,                customSettings: {"
"supabase\functions\process-blog-generation-queue\index.ts","82","site_id","site_id: site.id,"
"supabase\functions\process-dunning\index.ts","70","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-dunning\index.ts","112","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-dunning\index.ts","146","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-dunning\index.ts","167","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-dunning\index.ts","184","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-dunning\index.ts","207","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-expiring-complimentary\index.ts","61","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-expiring-complimentary\index.ts","94","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\process-expiring-complimentary\index.ts","107","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\quickbooks-callback\index.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"supabase\functions\quickbooks-disconnect\index.ts","3","site_id","* Updated with multi-tenant site_id isolation"
"supabase\functions\quickbooks-sync\index.ts","332","site_id",".upsert(customerData, { onConflict: 'qb_customer_id,company_id,site_id' })"
"supabase\functions\quickbooks-sync\index.ts","349","site_id",".upsert(itemData, { onConflict: 'qb_item_id,company_id,site_id' })"
"supabase\functions\quickbooks-sync\index.ts","390","site_id",".upsert(expenseData, { onConflict: 'qb_expense_id,company_id,site_id' })"
"supabase\functions\quickbooks-sync\index.ts","410","site_id",".upsert(paymentData, { onConflict: 'qb_payment_id,company_id,site_id' })"
"supabase\functions\risk-prediction\index.ts","518","site_id","site_id: string,"
"supabase\functions\risk-prediction\index.ts","528","site_id","site_id,  // CRITICAL: Site isolation"
"supabase\functions\risk-prediction\index.ts","540","site_id","site_id,  // CRITICAL: Site isolation"
"supabase\functions\risk-prediction\index.ts","555","site_id","site_id,  // CRITICAL: Site isolation"
"supabase\functions\risk-prediction\index.ts","570","site_id","site_id,  // CRITICAL: Site isolation"
"supabase\functions\schedule-trial-emails\index.ts","55","site_id","const { userId, email, firstName, companyName, site_id, site_key } = await req.json();"
"supabase\functions\schedule-trial-emails\index.ts","61","site_id","let siteId = site_id;"
"supabase\functions\schedule-trial-emails\index.ts","206","site_id","}, { onConflict: 'site_id,user_id' });"
"supabase\functions\send-intervention-email\index.ts","32","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\send-intervention-email\index.ts","41","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\send-renewal-notification\index.ts","55","site_id","site_id,"
"supabase\functions\send-renewal-notification\index.ts","102","site_id",".eq('site_id', subscriber.site_id)"
"supabase\functions\send-renewal-notification\index.ts","117","site_id",".eq('site_id', subscriber.site_id)"
"supabase\functions\send-renewal-notification\index.ts","201","site_id","site_id: subscriber.site_id,"
"supabase\functions\send-renewal-notification\index.ts","210","site_id",".eq('site_id', subscriber.site_id)"
"supabase\functions\send-scheduled-emails\index.ts","62","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\send-scheduled-emails\index.ts","91","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\send-scheduled-emails\index.ts","111","site_id",".eq('site_id', site.id)  // CRITICAL: Site isolation"
"supabase\functions\send-scheduled-emails\index.ts","149","site_id","site_id: site.id,  // CRITICAL: Site isolation"
"supabase\functions\send-scheduled-emails\index.ts","212","site_id","site_id: site.id,  // CRITICAL: Site isolation"
"supabase\functions\setup-mfa\index.ts","67","site_id","onConflict: 'user_id,site_id'  // Update conflict resolution for multi-tenant"
"supabase\functions\sitemap-generator\index.ts","22","site_id","let siteId = url.searchParams.get('site_id');"
"supabase\functions\sitemap-generator\index.ts","29","site_id","siteId = siteId || body.site_id;"
"supabase\functions\sso-ldap-auth\index.ts","279","site_id","site_id: ssoConnection.tenant_id,"
"supabase\functions\sso-oauth-callback\index.ts","328","site_id","site_id: ssoConnection.tenant_id,"
"supabase\functions\sso-saml-callback\index.ts","276","site_id","site_id: matchedConnection.tenant_id,"
"supabase\functions\stripe-webhook\index.ts","88","site_id",".eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\stripe-webhook\index.ts","108","site_id",".eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\stripe-webhook\index.ts","159","site_id","query = query.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\stripe-webhook\index.ts","185","site_id","updateQuery = updateQuery.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\stripe-webhook\index.ts","204","site_id","query = query.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\stripe-webhook\index.ts","220","site_id","subscriberQuery = subscriberQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\stripe-webhook\index.ts","234","site_id","failureQuery = failureQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\stripe-webhook\index.ts","270","site_id","updateQuery = updateQuery.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\stripe-webhook\index.ts","288","site_id","subscriberQuery = subscriberQuery.eq(""site_id"");  // CRITICAL: Site isolation"
"supabase\functions\stripe-webhook\index.ts","305","site_id","updateQuery = updateQuery.eq(""site_id"");  // CRITICAL: Site isolation on update"
"supabase\functions\sync-calendar\index.ts","75","site_id","onConflict: 'external_id,integration_id,site_id'"
"supabase\functions\track-usage\index.ts","60","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\track-usage\index.ts","77","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\track-usage\index.ts","95","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\track-usage\index.ts","140","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\track-usage\index.ts","181","site_id",".eq(""site_id"")  // CRITICAL: Site isolation"
"supabase\functions\trial-management\index.ts","70","site_id","id, name, trial_end_date, subscription_status, site_id,"
"supabase\functions\trial-management\index.ts","73","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\trial-management\index.ts","108","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\trial-management\index.ts","124","site_id",".eq(""site_id"", site.id)  // CRITICAL: Site isolation"
"supabase\functions\verify-domain\index.ts","10","site_id","site_id?: string;  // For multi-tenant isolation"
"supabase\functions\verify-domain\index.ts","82","site_id","const { site_id, tenant_id, domain }: VerifyDomainRequest = await req.json();"
"supabase\functions\verify-domain\index.ts","94","site_id","let siteId = site_id;"
"supabase\functions\verify-domain\index.ts","97","site_id",".select('site_id')"
"supabase\functions\verify-domain\index.ts","101","site_id","siteId = tenantForSite?.site_id;"
"supabase\functions\verify-domain\index.ts","175","site_id","auditLogEntry.site_id = siteId;"
"supabase\functions\webhook-delivery\index.ts","15","site_id","site_id: string"
"supabase\functions\webhook-delivery\index.ts","27","site_id","site_id: string"
"supabase\functions\webhook-delivery\index.ts","59","site_id","const { delivery_id, site_id } = body"
"supabase\functions\webhook-delivery\index.ts","67","site_id","if (site_id) {"
"supabase\functions\webhook-delivery\index.ts","68","site_id","query = query.eq('site_id', site_id)  // CRITICAL: Site isolation"
"supabase\functions\webhook-delivery\index.ts","101","site_id","if (delivery.site_id) {"
"supabase\functions\webhook-delivery\index.ts","102","site_id","endpointQuery = endpointQuery.eq('site_id', delivery.site_id)  // CRITICAL: Site isolation"
"supabase\functions\webhook-delivery\index.ts","129","site_id","await updateDeliveryRecord(supabaseClient, delivery.id, delivery.site_id, deliveryResult)"
"supabase\functions\webhook-delivery\index.ts","132","site_id","await updateEndpointStats(supabaseClient, endpoint.id, endpoint.site_id, deliveryResult.success)"
"supabase\functions\_shared\auth-helpers.ts","30","site_id","* Initialize authenticated Supabase client and extract site_id from JWT"
"supabase\functions\_shared\auth-helpers.ts","60","site_id","// Extract site_id from JWT (app_metadata or user_metadata)"
"supabase\functions\_shared\auth-helpers.ts","61","site_id","const siteId = user.app_metadata?.site_id || user.user_metadata?.site_id;"
"supabase\functions\_shared\auth-helpers.ts","63","site_id","console.error('[Auth] Missing site_id in JWT for user:', user.email);"
"supabase\functions\_shared\auth-helpers.ts","147","site_id",".select('company_id, site_id')"
"supabase\functions\_shared\auth-helpers.ts","150","site_id",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","160","site_id",".select('company_id, site_id')"
"supabase\functions\_shared\auth-helpers.ts","163","site_id",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","187","site_id",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","199","site_id",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","233","site_id","// Root admin check doesn't filter by site_id"
"supabase\functions\analyze-support-ticket\index.ts","320","siteId","async function getUserContext(supabase: any, ticket: any, siteId: string | null) {"
"supabase\functions\analyze-support-ticket\index.ts","327","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","351","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","365","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","379","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","391","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","405","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","504","siteId","async function findRelevantKBArticles(supabase: any, ticket: any, analysis: any, siteId: string | null) {"
"supabase\functions\analyze-support-ticket\index.ts","515","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","533","siteId","siteId: string | null,"
"supabase\functions\analyze-support-ticket\index.ts","550","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","551","siteId","insertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","566","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","573","siteId","async function saveTicketContext(supabase: any, ticketId: string, siteId: string | null, context: any) {"
"supabase\functions\analyze-support-ticket\index.ts","585","siteId","if (siteId) {"
"supabase\functions\analyze-support-ticket\index.ts","586","siteId","upsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\analyze-support-ticket\index.ts","590","siteId","onConflict: siteId ? 'ticket_id,site_id' : 'ticket_id'"
"supabase\functions\auto-intervention-scheduler\index.ts","144","siteId","console.log(`[AUTO-INTERVENTION-SCHEDULER] Processing site`, { siteId: site.id, siteKey: site.key });"
"supabase\functions\auto-intervention-scheduler\index.ts","233","siteId","siteId: site.id,"
"supabase\functions\blog-ai-automation\index.ts","83","siteId","let siteId = site_id;"
"supabase\functions\blog-ai-automation\index.ts","84","siteId","if (!siteId && site_key) {"
"supabase\functions\blog-ai-automation\index.ts","91","siteId","siteId = siteData?.id;"
"supabase\functions\blog-ai-automation\index.ts","100","siteId","siteId = defaultSite?.id;"
"supabase\functions\blog-ai-automation\index.ts","109","siteId","logStep(""Site resolved"", { siteId });"
"supabase\functions\blog-ai-automation\index.ts","141","siteId","siteId: string,"
"supabase\functions\calculate-health-scores\index.ts","80","siteId","allResults.push({ siteId: site.id, companyId: company.id, success: true, score: healthScore.score });"
"supabase\functions\calculate-health-scores\index.ts","83","siteId","allResults.push({ siteId: site.id, companyId: company.id, success: false, error: error.message });"
"supabase\functions\calculate-health-scores\index.ts","115","siteId","async function calculateCompanyHealthScore(supabase: any, company: Company, siteId: string) {"
"supabase\functions\calculate-lead-score\index.ts","49","siteId","console.log(`[CALCULATE-LEAD-SCORE] User authenticated: ${user.id}, siteId: ${siteId}`);"
"supabase\functions\calculate-lead-score\index.ts","180","siteId","console.log(`Calculated score for lead ${leadId}: ${totalScore} points (site: ${siteId})`);"
"supabase\functions\calculate-revenue-metrics\index.ts","65","siteId","console.log(`[CALCULATE-REVENUE-METRICS] Processing site`, { siteId: site.id, siteKey: site.key });"
"supabase\functions\calculate-revenue-metrics\index.ts","173","siteId","siteId: string,"
"supabase\functions\capture-lead\index.ts","97","siteId","if (siteId) {"
"supabase\functions\capture-lead\index.ts","133","siteId","if (siteId) {"
"supabase\functions\change-orders\index.ts","151","siteId","site_id: siteId          };"
"supabase\functions\change-orders\index.ts","182","siteId","site_id: siteId            }));"
"supabase\functions\check-subscription\index.ts","52","siteId","if (siteId) {"
"supabase\functions\check-subscription\index.ts","85","siteId","if (siteId) {"
"supabase\functions\check-subscription\index.ts","98","siteId","if (siteId) {"
"supabase\functions\check-subscription\index.ts","140","siteId","if (siteId) {"
"supabase\functions\check-subscription\index.ts","141","siteId","upsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\check-subscription\index.ts","145","siteId","onConflict: siteId ? 'email,site_id' : 'email'"
"supabase\functions\check-subscription\index.ts","208","siteId","if (siteId) {"
"supabase\functions\check-subscription\index.ts","209","siteId","subscriptionUpsertData.site_id = siteId;  // CRITICAL: Site isolation"
"supabase\functions\check-subscription\index.ts","213","siteId","onConflict: siteId ? 'email,site_id' : 'email'"
"supabase\functions\create-missing-content\index.ts","16","siteId","let siteId = body.site_id;"
"supabase\functions\create-missing-content\index.ts","30","siteId","siteId = site.id;"
"supabase\functions\create-missing-content\index.ts","363","siteId","console.log(`Post ${post.slug} already exists for site ${siteId}, skipping...`);"
"supabase\functions\create-missing-content\index.ts","385","siteId","message: `Content creation complete for site ${siteId}! Created: ${created}, Skipped: ${skipped}`,"
"supabase\functions\create-stripe-checkout\index.ts","138","siteId","if (siteId) {"
"supabase\functions\crm-email-automation\index.ts","42","siteId","siteId: string;"
"supabase\functions\crm-email-automation\index.ts","147","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","177","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","216","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","252","siteId","unsubscribe_url: `https://build-desk.com/unsubscribe?email=${encodeURIComponent(recipientEmail)}&site=${siteId}`,"
"supabase\functions\crm-email-automation\index.ts","340","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","356","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","421","siteId","siteId: string,"
"supabase\functions\crm-email-automation\index.ts","499","siteId","siteId: string,"
"supabase\functions\daily-reports\index.ts","128","siteId","site_id: siteId          };"
"supabase\functions\enhanced-blog-ai\index.ts","118","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","191","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","254","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","369","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","826","siteId","async function processQueueItem(supabaseClient: any, siteId: string, queueId: string) {"
"supabase\functions\enhanced-blog-ai\index.ts","892","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","918","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai\index.ts","955","siteId","async function analyzeContentDiversity(supabaseClient: any, siteId: string, companyId: string) {"
"supabase\functions\enhanced-blog-ai\index.ts","985","siteId","async function updateModelConfiguration(supabaseClient: any, siteId: string, config: any) {"
"supabase\functions\enhanced-blog-ai\index.ts","991","siteId","site_id: siteId  // CRITICAL: Site isolation"
"supabase\functions\enhanced-blog-ai\index.ts","1003","siteId","siteId: string,"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","37","siteId","let siteId = site_id || customSettings?.site_id;"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","38","siteId","if (!siteId && site_key) {"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","45","siteId","siteId = siteData?.id;"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","54","siteId","siteId = defaultSite?.id;"
"supabase\functions\enhanced-blog-ai-fixed\index.ts","57","siteId","logStep(""Site context resolved"", { siteId });"
"supabase\functions\execute-workflow\index.ts","87","siteId","if (siteId) {"
"supabase\functions\execute-workflow\index.ts","88","siteId","stepInsertData.site_id = siteId  // CRITICAL: Site isolation"
"supabase\functions\generate-churn-predictions\index.ts","42","siteId","logStep(`Processing site: ${site.key}`, { siteId: site.id });"
"supabase\functions\geofencing\index.ts","80","siteId","async function checkLocation(supabase: any, siteId: string, params: {"
"supabase\functions\geofencing\index.ts","149","siteId","async function checkGeofenceBreach(supabase: any, siteId: string, params: {"
"supabase\functions\geofencing\index.ts","205","siteId","async function processGPSEntry(supabase: any, siteId: string, params: {"
"supabase\functions\handle-demo-request\index.ts","50","siteId","let siteId = requestData.site_id;"
"supabase\functions\handle-demo-request\index.ts","51","siteId","if (!siteId && requestData.site_key) {"
"supabase\functions\handle-demo-request\index.ts","57","siteId","siteId = siteData?.id;"
"supabase\functions\handle-demo-request\index.ts","64","siteId","siteId = defaultSite?.id;"
"supabase\functions\handle-demo-request\index.ts","67","siteId","logStep(""Site resolved"", { siteId });"
"supabase\functions\image-processor\index.ts","74","siteId","siteId: string;"
"supabase\functions\image-processor\index.ts","148","siteId","if (!storagePath || !bucket || !siteId) {"
"supabase\functions\image-processor\index.ts","257","siteId","siteId: string;"
"supabase\functions\manage-complimentary-subscription\index.ts","46","siteId","logStep(""Site context extracted"", { siteId });"
"supabase\functions\optimize-resources\index.ts","293","siteId","async function detectResourceConflicts(assignments: any[], equipment: any[], supabaseClient: any, runId: string, siteId: string): Promise<any[]> {"
"supabase\functions\payment-reminders\index.ts","56","siteId","async function checkPendingReminders(supabase: any, siteId: string, tenant_id: string) {"
"supabase\functions\payment-reminders\index.ts","106","siteId","async function sendReminder(supabase: any, siteId: string, tenant_id: string, invoice_id: string) {"
"supabase\functions\payment-reminders\index.ts","170","siteId","async function generateReminders(supabase: any, siteId: string, tenant_id: string) {"
"supabase\functions\process-dunning\index.ts","57","siteId","logStep(""Processing site"", { siteId: site.id, siteKey: site.key });"
"supabase\functions\process-dunning\index.ts","76","siteId","logStep(""Error fetching payment failures for site"", { siteId: site.id, error: failuresError.message });"
"supabase\functions\process-dunning\index.ts","80","siteId","logStep(""Found payment failures for site"", { siteId: site.id, count: failuresToRetry?.length || 0 });"
"supabase\functions\process-dunning\index.ts","151","siteId","siteId: site.id,"
"supabase\functions\process-dunning\index.ts","188","siteId","logStep(""Invoice already paid"", { siteId: site.id, failureId: failure.id });"
"supabase\functions\process-dunning\index.ts","196","siteId","siteId: site.id,"
"supabase\functions\process-dunning\index.ts","219","siteId","logStep(""Site dunning completed"", { siteId: site.id, siteKey: site.key, results });"
"supabase\functions\process-dunning\index.ts","246","siteId","siteId: string"
"supabase\functions\process-expiring-complimentary\index.ts","48","siteId","logStep(`Processing site`, { siteId: site.id, siteKey: site.key });"
"supabase\functions\process-expiring-complimentary\index.ts","117","siteId","siteId: site.id,"
"supabase\functions\process-expiring-complimentary\index.ts","131","siteId","siteId: site.id,"
"supabase\functions\process-invoice-payment\index.ts","114","siteId","siteId  // Pass siteId for isolation"
"supabase\functions\process-invoice-payment\index.ts","192","siteId","siteId: string  // Added for site isolation"
"supabase\functions\process-referral-signup\index.ts","61","siteId","if (siteId) {"
"supabase\functions\process-referral-signup\index.ts","93","siteId","if (siteId) {"
"supabase\functions\process-referral-signup\index.ts","120","siteId","if (siteId) {"
"supabase\functions\process-referral-signup\index.ts","176","siteId","if (siteId) {"
"supabase\functions\process-referral-signup\index.ts","192","siteId","if (siteId) {"
"supabase\functions\quickbooks-route-transactions\index.ts","88","siteId","async function processSingleTransaction(supabase: any, siteId: string, companyId: string, transactionId: string) {"
"supabase\functions\quickbooks-route-transactions\index.ts","177","siteId","async function processBatchTransactions(supabase: any, siteId: string, companyId: string) {"
"supabase\functions\quickbooks-route-transactions\index.ts","284","siteId","async function manualAssignment(supabase: any, siteId: string, transactionId: string, assignment: any) {"
"supabase\functions\quickbooks-route-transactions\index.ts","340","siteId","async function importQuickBooksTransactions(supabase: any, siteId: string, companyId: string) {"
"supabase\functions\quickbooks-route-transactions\index.ts","342","siteId","// siteId would be used when inserting imported transactions"
"supabase\functions\quickbooks-route-transactions\index.ts","464","siteId","async function logRoutingEvent(supabase: any, siteId: string, event: any) {"
"supabase\functions\quickbooks-sync\index.ts","108","siteId","console.log(`[QUICKBOOKS-SYNC] User authenticated: ${user.id}, siteId: ${siteId}`);"
"supabase\functions\quickbooks-sync\index.ts","112","siteId","console.log(`Starting ${sync_type} sync for company: ${company_id}, site: ${siteId}`)"
"supabase\functions\quickbooks-sync\index.ts","318","siteId","async function syncCustomer(supabaseClient: any, siteId: string, companyId: string, qbCustomer: any) {"
"supabase\functions\quickbooks-sync\index.ts","335","siteId","async function syncItem(supabaseClient: any, siteId: string, companyId: string, qbItem: any) {"
"supabase\functions\quickbooks-sync\index.ts","352","siteId","async function getLocalInvoicesForSync(supabaseClient: any, siteId: string, companyId: string, syncType: string) {"
"supabase\functions\quickbooks-sync\index.ts","373","siteId","async function syncExpense(supabaseClient: any, siteId: string, companyId: string, qbPurchase: any) {"
"supabase\functions\quickbooks-sync\index.ts","393","siteId","async function syncPayment(supabaseClient: any, siteId: string, companyId: string, qbPayment: any) {"
"supabase\functions\quickbooks-sync\index.ts","424","siteId","async function syncInvoiceToQuickBooks(supabaseClient: any, siteId: string, baseUrl: string, realmId: string, accessToken: string, invoice: any) {"
"supabase\functions\reset-password-otp\index.ts","96","siteId","console.log(`[ResetPasswordOTP] Request reset for ${email} on site ${siteId}`);"
"supabase\functions\schedule-trial-emails\index.ts","61","siteId","let siteId = site_id;"
"supabase\functions\schedule-trial-emails\index.ts","68","siteId","siteId = siteData?.id;"
"supabase\functions\send-auth-otp\index.ts","96","siteId","console.log(`[SendAuthOTP] Processing ${type} request for ${email} on site ${siteId}`);"
"supabase\functions\send-booking-confirmation\index.ts","29","siteId","console.log('[SEND-BOOKING-CONFIRMATION] Auth context initialized', { siteId });"
"supabase\functions\send-intervention-email\index.ts","24","siteId","console.log('[SEND-INTERVENTION-EMAIL] Auth context initialized', { siteId });"
"supabase\functions\sitemap-generator\index.ts","22","siteId","let siteId = url.searchParams.get('site_id');"
"supabase\functions\sitemap-generator\index.ts","29","siteId","siteId = siteId || body.site_id;"
"supabase\functions\sitemap-generator\index.ts","34","siteId","if (!siteId && siteKey) {"
"supabase\functions\sitemap-generator\index.ts","40","siteId","siteId = siteData?.id;"
"supabase\functions\sitemap-generator\index.ts","49","siteId","siteId = defaultSite?.id;"
"supabase\functions\smart-procurement\index.ts","65","siteId","async function forecastMaterials(supabase: any, siteId: string, tenant_id: string, project_id?: string) {"
"supabase\functions\smart-procurement\index.ts","154","siteId","async function optimizeSuppliers(supabase: any, siteId: string, tenant_id: string) {"
"supabase\functions\smart-procurement\index.ts","200","siteId","async function generateRecommendations(supabase: any, siteId: string, tenant_id: string, project_id?: string) {"
"supabase\functions\store-stripe-keys\index.ts","84","siteId","if (!siteId) throw new Error(""Site ID not found in user context"");"
"supabase\functions\stripe-webhook\index.ts","123","siteId","async function processWebhookEvent(event: Stripe.Event, supabaseClient: any, stripe: Stripe, siteId: string | null) {"
"supabase\functions\stripe-webhook\index.ts","151","siteId","async function handleSubscriptionChange(subscription: Stripe.Subscription, supabaseClient: any, siteId: string | null) {"
"supabase\functions\stripe-webhook\index.ts","158","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","184","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","192","siteId","async function handleSubscriptionCancellation(subscription: Stripe.Subscription, supabaseClient: any, siteId: string | null) {"
"supabase\functions\stripe-webhook\index.ts","203","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","210","siteId","async function handlePaymentFailure(invoice: Stripe.Invoice, supabaseClient: any, stripe: Stripe, siteId: string | null) {"
"supabase\functions\stripe-webhook\index.ts","219","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","233","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","269","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","278","siteId","async function handlePaymentSuccess(invoice: Stripe.Invoice, supabaseClient: any, siteId: string | null) {"
"supabase\functions\stripe-webhook\index.ts","287","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","304","siteId","if (siteId) {"
"supabase\functions\stripe-webhook\index.ts","312","siteId","async function handleTrialWillEnd(subscription: Stripe.Subscription, supabaseClient: any, siteId: string | null) {"
"supabase\functions\track-referral\index.ts","61","siteId","if (siteId) {"
"supabase\functions\track-referral\index.ts","84","siteId","if (siteId) {"
"supabase\functions\track-referral\index.ts","129","siteId","if (siteId) {"
"supabase\functions\track-usage\index.ts","135","siteId","async function checkUsageAlerts(companyId: string, metricType: string, supabaseClient: any, siteId: string) {"
"supabase\functions\trial-management\index.ts","64","siteId","logStep(`Processing site: ${site.key}`, { siteId: site.id });"
"supabase\functions\trial-management\index.ts","115","siteId","logStep(""Activated grace period"", { companyId: company.id, siteId: site.id });"
"supabase\functions\trial-management\index.ts","130","siteId","logStep(""Trial expired and suspended"", { companyId: company.id, siteId: site.id });"
"supabase\functions\verify-domain\index.ts","94","siteId","let siteId = site_id;"
"supabase\functions\verify-domain\index.ts","101","siteId","siteId = tenantForSite?.site_id;"
"supabase\functions\verify-domain\index.ts","108","siteId","siteId = defaultSite?.id;"
"supabase\functions\verify-domain\index.ts","117","siteId","if (siteId) {"
"supabase\functions\verify-domain\index.ts","146","siteId","if (siteId) {"
"supabase\functions\verify-domain\index.ts","174","siteId","if (siteId) {"
"supabase\functions\verify-domain\index.ts","175","siteId","auditLogEntry.site_id = siteId;"
"supabase\functions\webhook-delivery\index.ts","283","siteId","siteId: string | null,"
"supabase\functions\webhook-delivery\index.ts","313","siteId","if (siteId) {"
"supabase\functions\webhook-delivery\index.ts","324","siteId","siteId: string | null,"
"supabase\functions\webhook-delivery\index.ts","332","siteId","if (siteId) {"
"supabase\functions\webhook-delivery\index.ts","363","siteId","if (siteId) {"
"supabase\functions\workflow-execution\index.ts","204","siteId","async function executeAction(step: WorkflowStep, context: any, supabase: any, siteId: string) {"
"supabase\functions\workflow-execution\index.ts","307","siteId","async function createTask(params: any, context: any, supabase: any, siteId: string) {"
"supabase\functions\workflow-execution\index.ts","330","siteId","async function updateField(params: any, context: any, supabase: any, siteId: string) {"
"supabase\functions\_shared\auth-helpers.ts","10","siteId","* const { siteId, supabase } = authContext;"
"supabase\functions\_shared\auth-helpers.ts","25","siteId","siteId: string;"
"supabase\functions\_shared\auth-helpers.ts","33","siteId","* @returns AuthContext with user, siteId, and authenticated supabase client, or null if auth fails"
"supabase\functions\_shared\auth-helpers.ts","61","siteId","const siteId = user.app_metadata?.site_id || user.user_metadata?.site_id;"
"supabase\functions\_shared\auth-helpers.ts","62","siteId","if (!siteId) {"
"supabase\functions\_shared\auth-helpers.ts","67","siteId","console.log(`[Auth] User ${user.email} authenticated for site: ${siteId}`);"
"supabase\functions\_shared\auth-helpers.ts","69","siteId","return { user, siteId, supabase };"
"supabase\functions\_shared\auth-helpers.ts","135","siteId","* @param siteId - Site ID to verify"
"supabase\functions\_shared\auth-helpers.ts","142","siteId","siteId: string"
"supabase\functions\_shared\auth-helpers.ts","150","siteId",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","163","siteId",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","174","siteId","* @param siteId - Site ID"
"supabase\functions\_shared\auth-helpers.ts","180","siteId","siteId: string"
"supabase\functions\_shared\auth-helpers.ts","187","siteId",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","199","siteId",".eq('site_id', siteId)"
"supabase\functions\_shared\auth-helpers.ts","210","siteId","* @param siteId - Site ID"
"supabase\functions\_shared\auth-helpers.ts","216","siteId","siteId: string"
"supabase\functions\_shared\auth-helpers.ts","218","siteId","const role = await getUserRole(supabase, userId, siteId);"
"supabase\functions\_shared\auth-helpers.ts","297","siteId","*   const { siteId, supabase } = authContext;"
"supabase\functions\_shared\auth-helpers.ts","299","siteId","*   return successResponse({ message: 'Hello from ' + siteId }, req);"
"supabase\functions\_shared\ses-email-service.ts","26","siteId","siteId: string;"
"supabase\functions\_shared\ses-email-service.ts","38","siteId","siteId: 'builddesk',"
"supabase\functions\_shared\ses-email-service.ts","133","siteId","siteId: string"
"supabase\functions\_shared\ses-email-service.ts","139","siteId",".eq('id', siteId)"
"supabase\functions\_shared\ses-email-service.ts","143","siteId","console.log('[SES] Using default site config for:', siteId);"
"supabase\functions\_shared\ses-email-service.ts","150","siteId","siteId: site.id,"
"supabase\functions\stripe-webhook\index.ts","6","getSiteByDomain","import { getSiteByDomain } from '../_shared/auth-helpers.ts';"
"supabase\functions\_shared\auth-helpers.ts","261","getSiteByDomain","export async function getSiteByDomain("
